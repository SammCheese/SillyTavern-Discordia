export const __webpack_esm_id__=288;export const __webpack_esm_ids__=[288];export const __webpack_esm_modules__={1752(t,e,r){r.d(e,{SQ:()=>i,YL:()=>o});var a=r(5656),n=r(7140);const s=(0,n.createContext)(void 0),o=({children:t})=>{const[e,r]=(0,n.useState)(""),o=(0,n.useCallback)(t=>{r(t)},[]);return(0,a.jsx)(s.Provider,{value:{searchQuery:e,setSearchQuery:o},children:t})},i=()=>{const t=(0,n.useContext)(s);if(!t)throw new Error("useSearch cannot be used outside of SearchProvider");return t}},3228(t,e,r){r.a(t,async(t,a)=>{try{r.d(e,{eS:()=>S,r8:()=>w,yG:()=>T,yN:()=>A});r(5656),r(7140);var n=r(5822).V;const{characters:s,getRequestHeaders:o,getThumbnailUrl:i,system_avatar:c,default_avatar:p,openCharacterChat:l,setActiveCharacter:h,setActiveGroup:d,getCurrentChatId:u,saveSettingsDebounced:g,selectCharacterById:C}=await n("@script"),{groups:m,openGroupById:_,openGroupChat:v}=await n("@scripts/groupChats"),{sortMoments:E,timestampToMoment:f,isDataURL:y}=await n("@scripts/utils");async function w(t,e=20){const r=await fetch("/api/chats/recent",{method:"POST",headers:o(),body:JSON.stringify({max:e})});if(!r.ok)return console.warn("Failed to fetch recent character chats"),[];const a=await r.json();if(!Array.isArray(a)||0===a.length)return[];const n=a.sort((t,e)=>E(f(t.last_mes),f(e.last_mes))).map(t=>({chat:t,character:s.find(e=>e.avatar===t.avatar),group:m.find(e=>e.id===t.group)})).filter(t=>t.character||t.group).filter(e=>{if(!t||0===t.length)return!0;return!!t.find(t=>e.character&&"character"===t.type&&t.item.avatar.toString()===e.character.avatar.toString()||e.group&&"group"===t.type&&t.id.toString()===e.group.id.toString())});return n.forEach(({chat:t,character:e,group:r},a)=>{const n=f(t.last_mes);t.char_name=e?.name||r?.name||"",t.date_short=n.format("l"),t.date_long=n.format("LL LT"),t.chat_name=t.file_name.replace(".jsonl",""),t.char_thumbnail=e?i("avatar",e.avatar):c,t.is_group=!!r,t.hidden=a>=15,t.avatar=t.avatar||"",t.group=t.group||"",t.char_id=e?s.indexOf(e):void 0}),n.map(t=>t.chat)}const T=async(t,e)=>{try{if(await C(t),h(t),g(),u()===e)return;await l(e)}catch(t){console.error("Error selecting character:",t)}},S=async({group:t,chat_id:e,id:r})=>{try{if(!t&&!r)return;const a=r||t?.id.toString()||"";if(!a)return;if(await _(a),d(a),g(),!e||u()===e)return;await v(a,e)}catch(t){console.error("Error selecting group:",t)}},A=({chat:t,charId:e,groupId:r})=>{if(t&&t?.avatar)return i("avatar",t?.avatar);if(e||r||(e=SillyTavern.getContext().characterId,r=SillyTavern.getContext().groupId),null!=r){return SillyTavern.getContext().groups.find(t=>t.id.toString()===r.toString()).avatar_url}const a="string"==typeof e?parseInt(e):e??-1,n=SillyTavern.getContext().characters[a];return n?i("avatar",n.avatar):c};a()}catch(D){a(D)}},1)},5288(t,e,r){r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{App:()=>u,default:()=>g});var n=r(5656),s=r(7140),o=r(5219),i=r(5902),c=r(1752),p=r(7325),l=t([i]),h=l.then?(await l)():l;i=h[0];const d=(0,s.lazy)(()=>r.e(745).then(r.bind(r,1745))),u=()=>{const{open:t,setOpen:e,entities:r,chats:a,icons:s,isLoadingChats:l}=(0,i.p)();return(0,o.createPortal)((0,n.jsx)(c.YL,{children:(0,n.jsx)(d,{open:t,setOpen:e,entities:r,chats:a,icons:s,isLoadingChats:l})}),p.o)},g=u;a()}catch(t){a(t)}})},5822(t,e,r){r.d(e,{V:()=>o});let a=null,n=!1;const s=(t,e)=>e?t.startsWith("../")?`../../../../../public/${t.slice(3)}`:`../../../../../public/scripts/${t}`:`../../../../${t}`,o=async t=>{n&&null!==a||await(async()=>{if(n)return;let t=!1;try{const e="../../../../../script.js",r=await import(e);r||Object.keys(r).length||(t=!0)}catch{t=!0}a={"@script":s("../script.js",t),"@scripts/groupChats":s("group-chats.js",t),"@scripts/utils":s("utils.js",t),"@scripts/welcomeScreen":s("welcome-screen.js",t),"@scripts/personas":s("personas.js",t),"@scripts/chats":s("chats.js",t),"@scripts/powerUser":s("power-user.js",t),"@scripts/extensions":s("extensions.js",t),"@scripts/worldInfo":s("world-info.js",t),"@scripts/naiSettings":s("nai-settings.js",t),"@scripts/openai":s("openai.js",t),"@scripts/kaiSettings":s("kai-settings.js",t),"@scripts/horde":s("horde.js",t),"@scripts/textGenSettings":s("textgen-settings.js",t),"@scripts/presetManager":s("preset-manager.js",t),"@scripts/secrets":s("secrets.js",t)},n=!0,console.log(`[SillyTavern-Discordia] Running as ${t?"local":"global"} extension.`)})();try{const e=a[t]||t;return await import(e)}catch(e){return console.error(`Error importing ${t} (${a[t]}):`,e),{}}}},5902(t,e,r){r.a(t,async(t,a)=>{try{r.d(e,{p:()=>C});var n=r(7140),s=r(3228),o=r(5822).V,i=t([s]),c=i.then?(await i)():i;s=c[0];const{getGroupPastChats:p}=await o("@scripts/groupChats"),{getEntitiesList:l,eventSource:h,event_types:d,getPastCharacterChats:u}=await o("@script"),g=[{name:"Backgrounds",id:"#backgrounds-button"},{name:"Persona Management",id:"#persona-management-button"},{name:"Character Selector",id:"#rightNavHolder"},{name:"Extensions Settings",id:"#extensions-settings-button"},{name:"Advanced Formatting",id:"#advanced-formatting-button"},{name:"World Info",id:"#WI-SP-button"}],C=()=>{const[t,e]=(0,n.useState)({open:!1,entities:[],chats:[],icons:[],isLoadingChats:!0}),r=(0,n.useCallback)(t=>{e(e=>({...e,open:t}))},[]),a=(0,n.useCallback)(async()=>{e(t=>({...t,isLoadingChats:!0}));const{characterId:t,groupId:r}=SillyTavern.getContext();let a=[];try{null!==r?(a=await p(r.toString()),e(t=>({...t,chats:a,isLoadingChats:!1}))):void 0!==t&&parseInt(t)>=0&&(a=await u(),e(t=>({...t,chats:a,isLoadingChats:!1})))}catch(t){console.error("Error updating chat data:",t),o()}},[]),o=(0,n.useCallback)(async()=>{const t=l({doFilter:!0,doSort:!0}),r=await(0,s.r8)(t);e(e=>({...e,chats:r,entities:t,open:!0,isLoadingChats:!1}))},[]),i=(0,n.useCallback)(()=>{const t=$("#top-settings-holder");if(!t.length)return;const r=[];t.children().each((t,e)=>{const a=$(e),n=`#${a.attr("id")}`,s=a.find(".drawer-icon");r.push({className:s.attr("class")||"",title:s.attr("title")||a.find(".drawer-toggle").attr("title")||"",showInProfile:!g.some(t=>t.id===n),id:n})}),t.attr("style","display: none !important;"),e(t=>({...t,icons:r}))},[]);return(0,n.useEffect)(()=>{i();const e=()=>{window.innerWidth>1e3&&!t.open&&r(!0)};h.on(d.APP_READY,o),h.on(d.CHAT_CHANGED,a),h.on(d.CHAT_DELETED,a),h.on(d.CHAT_CREATED,a),h.on(d.SETTINGS_UPDATED,e),h.on(d.CHARACTER_EDITED,o),h.on(d.CHARACTER_RENAMED,o),h.on(d.CHARACTER_DELETED,o),h.on("DISCORDIA_HOME_BUTTON_CLICKED",o);const n=$("body");let s=0,c=0;const p=t=>{s=t.clientX??0},l=t=>{c=t.clientX??0},u=t=>{s=t.originalEvent?.touches[0]?.clientX??0},g=t=>{c=t.originalEvent?.touches[0]?.clientX??0},C=()=>{0!==s&&0!==c&&(c>s+100?r(!0):c<s-100&&window.innerWidth<=1e3&&r(!1),s=0,c=0)};return n&&(n.on("pointerdown",p),n.on("pointermove",l),n.on("touchstart",u),n.on("touchmove",g),n.on("touchend pointerup",C)),()=>{h.removeListener(d.APP_READY,o),h.removeListener(d.CHAT_CHANGED,a),h.removeListener(d.CHAT_DELETED,a),h.removeListener(d.CHAT_CREATED,a),h.removeListener(d.SETTINGS_UPDATED,e),h.removeListener(d.CHARACTER_EDITED,o),h.removeListener(d.CHARACTER_RENAMED,o),h.removeListener(d.CHARACTER_DELETED,o),h.removeListener("DISCORDIA_HOME_BUTTON_CLICKED",o),n&&(n.off("pointerdown",p),n.off("pointermove",l),n.off("touchstart",u),n.off("touchmove",g),n.off("touchend pointerup",C))}},[]),{...t,setOpen:r}};a()}catch(t){a(t)}},1)}};
//# sourceMappingURL=288.bundle.js.map