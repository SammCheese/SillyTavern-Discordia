export const __webpack_esm_id__=288;export const __webpack_esm_ids__=[288];export const __webpack_esm_modules__={3583(e,t,n){n.d(t,{SQ:()=>i,YL:()=>c});var r=n(5656),o=n(7140);const s=(0,o.createContext)(void 0),a=SillyTavern.libs.lodash,c=({children:e})=>{const[t,n]=(0,o.useState)(""),c=(0,o.useCallback)(e=>{a.debounce(()=>{n(e)},300)()},[]);return(0,r.jsx)(s.Provider,{value:{searchQuery:t,setSearchQuery:c},children:e})},i=()=>{const e=(0,o.useContext)(s);if(!e)throw new Error("useSearch cannot be used outside of SearchProvider");return e}},5288(e,t,n){n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{App:()=>_,default:()=>C});var o=n(5656),s=n(7140),a=n(5219),c=n(5902),i=n(3583),E=n(3133),u=e([c,E]);[c,E]=u.then?(await u)():u;const l=(0,s.lazy)(()=>n.e(745).then(n.bind(n,1745))),_=()=>{const e=(0,c.p)(),t=(0,s.useMemo)(()=>e,[e.open,e.setOpen,e.entities,e.chats,e.icons,e.isLoadingChats,e.isInitialLoad]);return(0,a.createPortal)((0,o.jsx)(i.YL,{children:(0,o.jsx)(l,{...t})}),E.o)},C=_;r()}catch(e){r(e)}})},5902(e,t,n){n.a(e,async(e,r)=>{try{n.d(t,{p:()=>p});var o=n(7140),s=n(5148),a=n(3696),c=n(5822).V,i=e([s]),E=i.then?(await i)():i;s=E[0];const{getGroupPastChats:u}=await c("@scripts/groupChats"),{getEntitiesList:l,eventSource:_,event_types:C,getPastCharacterChats:T}=await c("@script"),d=[{name:"User Settings",id:"#user-settings-button"},{name:"Profile",id:"#sys-settings-button"},{name:"Account",id:"#ai-config-button"}],h=(e,t)=>{switch(t.type){case"SET_OPEN":return{...e,open:t.open};case"REFRESH_START":return{...e,isLoadingChats:!0};case"REFRESH_SUCCESS":return{...e,...t,isLoadingChats:!1};case"REFRESH_FAILURE":return console.error("Failed to refresh sidebar chats:",t.error),{...e,isLoadingChats:!1};case"SET_ICONS":return{...e,icons:t.icons};case"SET_INITIAL_LOAD":return{...e,isInitialLoad:t.isInitialLoad};case"SET_CONTEXT":return{...e,context:t.context};default:return e}},S={open:!0,entities:[],chats:[],recentChats:[],icons:[],isLoadingChats:!0,isInitialLoad:!0,context:"recent"},p=()=>{const[e,t]=(0,o.useReducer)(h,S),n=(0,o.useRef)(!1),r=(0,o.useRef)(!1),c=(0,o.useRef)(e.open);(0,o.useEffect)(()=>{c.current=e.open},[e.open]);const i=(0,o.useCallback)(e=>{t({type:"SET_OPEN",open:e})},[]),E=(0,o.useCallback)(async()=>{t({type:"REFRESH_START"});try{const e=l({doFilter:!0,doSort:!0});t({type:"REFRESH_SUCCESS",entities:e})}catch(e){t({type:"REFRESH_FAILURE",error:e})}},[]),p=(0,o.useCallback)(async()=>{t({type:"REFRESH_START"});try{const e=await(0,s.r8)();t({type:"REFRESH_SUCCESS",recentChats:e})}catch(e){console.error("Failed to refresh recent chats:",e)}},[]),R=(0,o.useCallback)(async(e=!1)=>{if(!n.current||e){t({type:"SET_CONTEXT",context:e?"recent":"chat"}),n.current=!0,t({type:"REFRESH_START"});try{const{characterId:e,groupId:n}=SillyTavern.getContext(),r=null!=n,o=null!=e&&Number(e)>=0;let s=[];r?s=await u(n.toString()):o&&(s=await T()),t({type:"REFRESH_SUCCESS",chats:s})}catch(e){t({type:"REFRESH_FAILURE",error:e})}finally{n.current=!1,r.current&&(r.current=!1),t({type:"SET_INITIAL_LOAD",isInitialLoad:!1})}}else r.current=!0},[]),A=(0,o.useCallback)(()=>{E(),R(),p()},[E,R,p]),y=(0,o.useCallback)(()=>{R()},[]),L=(0,o.useCallback)(()=>{const e=$("#top-settings-holder");if(!e.length)return;const n=[];e.children().each((e,t)=>{const r=$(t),o=`#${r.attr("id")}`,s=r.find(".drawer-icon");n.push({className:s.attr("class")||"",title:s.attr("title")||r.find(".drawer-toggle").attr("title")||"",showInProfile:d.some(e=>e.id===o),id:o})}),e.attr("style","display: none !important;"),t({type:"SET_ICONS",icons:n})},[]),f=async()=>{t({type:"SET_CONTEXT",context:"recent"}),p(),E()};return(0,o.useEffect)(()=>{L();const e=()=>{c.current||window.innerWidth>1e3&&i(!0)};_.on(C.APP_READY,A),_.on(C.CHAT_CHANGED,R),_.on(C.CHAT_DELETED,R),_.on(C.CHAT_CREATED,R),_.on(C.SETTINGS_UPDATED,e),_.on(C.CHARACTER_EDITED,E),_.on(C.CHARACTER_RENAMED,E),_.on(a.V.ENTITY_CHANGED,E),_.on(a.V.HOME_BUTTON_CLICKED,f),_.on(a.V.CHAT_UPDATE,y);const t=$("body");let n=0,r=0;const o=e=>{n=e.clientX??0},s=e=>{r=e.clientX??0},u=e=>{n=e.originalEvent?.touches[0]?.clientX??0},l=e=>{r=e.originalEvent?.touches[0]?.clientX??0},T=()=>{0!==n&&0!==r&&(r>n+100?i(!0):r<n-100&&window.innerWidth<=1e3&&i(!1),n=0,r=0)};return t&&(t.on("pointerdown",o),t.on("pointermove",s),t.on("touchstart",u),t.on("touchmove",l),t.on("touchend pointerup",T)),()=>{_.removeListener(C.APP_READY,A),_.removeListener(C.CHAT_CHANGED,R),_.removeListener(C.CHAT_DELETED,R),_.removeListener(C.CHAT_CREATED,R),_.removeListener(C.SETTINGS_UPDATED,e),_.removeListener(C.CHARACTER_EDITED,E),_.removeListener(C.CHARACTER_RENAMED,E),_.removeListener(a.V.ENTITY_CHANGED,E),_.removeListener(a.V.HOME_BUTTON_CLICKED,f),_.removeListener(a.V.CHAT_UPDATE,y),t&&(t.off("pointerdown",o),t.off("pointermove",s),t.off("touchstart",u),t.off("touchmove",l),t.off("touchend pointerup",T))}},[A,L,R,i]),{...e,setOpen:i}};r()}catch(e){r(e)}},1)}};
//# sourceMappingURL=288.bundle.js.map