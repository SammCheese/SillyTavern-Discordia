export const __webpack_esm_id__=288;export const __webpack_esm_ids__=[288];export const __webpack_esm_modules__={3583(e,t,n){n.d(t,{SQ:()=>a,YL:()=>i});var r=n(5656),o=n(7140);const s=(0,o.createContext)(void 0),i=({children:e})=>{const[t,n]=(0,o.useState)(""),i=(0,o.useCallback)(e=>{n(e)},[]);return(0,r.jsx)(s.Provider,{value:{searchQuery:t,setSearchQuery:i},children:e})},a=()=>{const e=(0,o.useContext)(s);if(!e)throw new Error("useSearch cannot be used outside of SearchProvider");return e}},5288(e,t,n){n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{App:()=>_,default:()=>d});var o=n(5656),s=n(7140),i=n(5219),a=n(5902),c=n(3583),E=n(3133),u=e([a,E]);[a,E]=u.then?(await u)():u;const l=(0,s.lazy)(()=>n.e(745).then(n.bind(n,1745))),_=()=>{const e=(0,a.p)(),t=(0,s.useMemo)(()=>e,[e.open,e.setOpen,e.entities,e.chats,e.icons,e.isLoadingChats,e.isInitialLoad]);return(0,i.createPortal)((0,o.jsx)(c.YL,{children:(0,o.jsx)(l,{...t})}),E.o)},d=_;r()}catch(e){r(e)}})},5902(e,t,n){n.a(e,async(e,r)=>{try{n.d(t,{p:()=>A});var o=n(7140),s=n(5148),i=n(3696),a=n(5822).V,c=e([s]),E=c.then?(await c)():c;s=E[0];const{getGroupPastChats:u}=await a("@scripts/groupChats"),{getEntitiesList:l,eventSource:_,event_types:d,getPastCharacterChats:T}=await a("@script"),C=[{name:"User Settings",id:"#user-settings-button"},{name:"Profile",id:"#sys-settings-button"},{name:"Account",id:"#ai-config-button"}],h=(e,t)=>{switch(t.type){case"SET_OPEN":return{...e,open:t.open};case"REFRESH_START":return{...e,isLoadingChats:!0};case"REFRESH_SUCCESS":return{...e,chats:t.chats,entities:t.entities,isLoadingChats:!1};case"REFRESH_FAILURE":return console.error("Failed to refresh sidebar chats:",t.error),{...e,isLoadingChats:!1};case"SET_ICONS":return{...e,icons:t.icons};case"SET_INITIAL_LOAD":return{...e,isInitialLoad:t.isInitialLoad};case"SET_CONTEXT":return{...e,context:t.context};default:return e}},p={open:!0,entities:[],chats:[],icons:[],isLoadingChats:!0,isInitialLoad:!0,context:"recent"},A=()=>{const[e,t]=(0,o.useReducer)(h,p),n=(0,o.useRef)(!1),r=(0,o.useRef)(!1),a=(0,o.useRef)(e.open);(0,o.useEffect)(()=>{a.current=e.open},[e.open]);const c=(0,o.useCallback)(e=>{t({type:"SET_OPEN",open:e})},[]),E=(0,o.useCallback)(async(e=!1)=>{if(!n.current||e){t({type:"SET_CONTEXT",context:e?"recent":"chat"}),n.current=!0,t({type:"REFRESH_START"});try{const{characterId:n,groupId:r}=SillyTavern.getContext(),o=null!=r,i=null!=n&&Number(n)>=0,a=l({doFilter:!0,doSort:!0});let c=[];o?c=await u(r.toString()):i?c=await T():e&&(c=await(0,s.r8)(a)),t({type:"REFRESH_SUCCESS",chats:c,entities:a})}catch(e){t({type:"REFRESH_FAILURE",error:e})}finally{n.current=!1,r.current&&(r.current=!1),t({type:"SET_INITIAL_LOAD",isInitialLoad:!1})}}else r.current=!0},[]),A=(0,o.useCallback)(()=>{E(!0)},[E]),S=(0,o.useCallback)(()=>{E()},[]),R=(0,o.useCallback)(()=>{const e=$("#top-settings-holder");if(!e.length)return;const n=[];e.children().each((e,t)=>{const r=$(t),o=`#${r.attr("id")}`,s=r.find(".drawer-icon");n.push({className:s.attr("class")||"",title:s.attr("title")||r.find(".drawer-toggle").attr("title")||"",showInProfile:C.some(e=>e.id===o),id:o})}),e.attr("style","display: none !important;"),t({type:"SET_ICONS",icons:n})},[]);return(0,o.useEffect)(()=>{R();const e=()=>{a.current||window.innerWidth>1e3&&c(!0)};_.on(d.APP_READY,A),_.on(d.CHAT_CHANGED,E),_.on(d.CHAT_DELETED,E),_.on(d.CHAT_CREATED,E),_.on(d.SETTINGS_UPDATED,e),_.on(d.CHARACTER_EDITED,E),_.on(d.CHARACTER_RENAMED,E),_.on(i.V.ENTITY_CHANGED,A),_.on(i.V.HOME_BUTTON_CLICKED,A),_.on(i.V.CHAT_UPDATE,S);const t=$("body");let n=0,r=0;const o=e=>{n=e.clientX??0},s=e=>{r=e.clientX??0},u=e=>{n=e.originalEvent?.touches[0]?.clientX??0},l=e=>{r=e.originalEvent?.touches[0]?.clientX??0},T=()=>{0!==n&&0!==r&&(r>n+100?c(!0):r<n-100&&window.innerWidth<=1e3&&c(!1),n=0,r=0)};return t&&(t.on("pointerdown",o),t.on("pointermove",s),t.on("touchstart",u),t.on("touchmove",l),t.on("touchend pointerup",T)),()=>{_.removeListener(d.APP_READY,E),_.removeListener(d.CHAT_CHANGED,E),_.removeListener(d.CHAT_DELETED,E),_.removeListener(d.CHAT_CREATED,E),_.removeListener(d.SETTINGS_UPDATED,e),_.removeListener(d.CHARACTER_EDITED,E),_.removeListener(d.CHARACTER_RENAMED,E),_.removeListener(i.V.ENTITY_CHANGED,A),_.removeListener(i.V.HOME_BUTTON_CLICKED,A),_.removeListener(i.V.CHAT_UPDATE,S),t&&(t.off("pointerdown",o),t.off("pointermove",s),t.off("touchstart",u),t.off("touchmove",l),t.off("touchend pointerup",T))}},[A,R,E,c]),{...e,setOpen:c}};r()}catch(e){r(e)}},1)}};
//# sourceMappingURL=288.bundle.js.map