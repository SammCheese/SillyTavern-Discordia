export const __webpack_esm_id__=457;export const __webpack_esm_ids__=[457];export const __webpack_esm_modules__={9457(e,t,i){i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>b});var s=i(5656),a=i(7140),r=i(7963),c=i(3228),l=i(1752),d=i(7393),o=i(3696),u=i(5822).V,h=e([c]),y=h.then?(await h)():h;c=y[0];const x=(0,a.lazy)(()=>i.e(939).then(i.bind(i,939))),C=(0,a.lazy)(()=>i.e(308).then(i.bind(i,6308))),m=(0,a.lazy)(()=>i.e(187).then(i.bind(i,3187))),{getGroupPastChats:f}=await u("@scripts/groupChats"),{getPastCharacterChats:p,characters:_,closeCurrentChat:w,eventSource:g,event_types:v}=await u("@script"),S=(0,a.memo)(function({entity:e,index:t,isSelected:i,style:n,onClick:a}){return(0,s.jsx)("div",{style:n,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",id:`character-button-${e.id}`,title:e.item?.name||e.id,children:(0,s.jsx)(x,{entity:e,index:t,isSelected:i,onClick:a})})},(e,t)=>e.entity===t.entity&&e.isSelected===t.isSelected&&e.onClick===t.onClick),j=({index:e,style:t,data:i})=>{const{entities:n,selectedIndex:a,handleItemClick:r}=i,c=n[e];return c?(0,s.jsx)(S,{index:e,entity:c,style:t,isSelected:a===e,onClick:r}):(0,s.jsx)("div",{style:t,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",children:(0,s.jsx)(C,{onClick:()=>{}})})},k=({entities:e})=>{const[t,i]=(0,a.useState)(null),{searchQuery:n}=(0,l.SQ)(),u=(0,a.useCallback)(async()=>{i(null),await w(),await g.emit(o.V.HOME_BUTTON_CLICKED)},[]),h=(0,a.useCallback)(async(e,t)=>{i(t);try{if("group"===e.type){const t=e.id.toString();if(!SillyTavern.getContext().groups.find(e=>e.id.toString()===t))return;await w();const i=await f(t);await(0,c.eS)({group:e,chat_id:i[0]?.file_id})}else{const t=_.findIndex(t=>t.avatar===e?.item?.avatar);if(-1===t)return;await w();const i=await p(t);await(0,c.yG)(t,i[0]?.file_id)}}catch(e){console.error("Error selecting entity:",e)}},[]);(0,a.useEffect)(()=>{y()},[e]);const y=(0,a.useCallback)(()=>{const{characterId:t,groupId:n}=SillyTavern.getContext();if(null!=n){const t=e.findIndex(e=>"group"===e.type&&e.id.toString()===n.toString());i(-1!==t?t:null)}else if(void 0!==t&&parseInt(t)>=0){const n=e.findIndex(e=>"character"===e.type&&e.id.toString()===t.toString());i(-1!==n?n:null)}else i(null)},[e]);(0,a.useEffect)(()=>(g.on(v.CHAT_CHANGED,y),()=>{g.removeListener(v.CHAT_CHANGED,y)}),[y]);const x=(0,a.useMemo)(()=>({entities:e,selectedIndex:t,handleItemClick:h}),[e,h]),k=(0,a.useMemo)(()=>n?e.filter(e=>(e.item?.name||"").toLowerCase().includes(n.toLowerCase())):e,[e,n]);return(0,s.jsx)(d.A,{children:(0,s.jsxs)("div",{id:"character-container",children:[(0,s.jsxs)("div",{id:"characters-header",children:[(0,s.jsx)(m,{onClick:u}),(0,s.jsx)("div",{id:"characters-divider",className:"divider"})]}),(0,s.jsx)("div",{id:"characters-list",className:"pt-0.5",children:k.length<50?(0,s.jsxs)(s.Fragment,{children:[k.map(i=>{const n=e.indexOf(i);return(0,s.jsx)(S,{entity:i,index:n,isSelected:t===n,onClick:h,style:{}},i.id.toString())}),(0,s.jsx)("div",{id:"characters-divider",className:"divider"}),(0,s.jsx)(C,{onClick:()=>{}})]}):(0,s.jsx)(r.B8,{rowComponent:j,rowCount:k.length+1,rowHeight:60,rowProps:{data:x},style:{width:"100%"},overscanCount:5})})]})})},b=(0,a.memo)(k);n()}catch(e){n(e)}},1)}};
//# sourceMappingURL=457.bundle.js.map