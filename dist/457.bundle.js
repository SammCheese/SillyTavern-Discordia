export const __webpack_esm_id__=457;export const __webpack_esm_ids__=[457];export const __webpack_esm_modules__={9457(e,t,i){i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>k});var s=i(5656),a=i(7140),r=i(7963),c=i(3228),l=i(1752),d=i(7393),o=i(5822).V,u=e([c]),h=u.then?(await u)():u;c=h[0];const y=(0,a.lazy)(()=>i.e(939).then(i.bind(i,939))),x=(0,a.lazy)(()=>i.e(308).then(i.bind(i,6308))),C=(0,a.lazy)(()=>i.e(187).then(i.bind(i,3187))),{getGroupPastChats:m}=await o("@scripts/groupChats"),{getPastCharacterChats:f,characters:_,closeCurrentChat:p,eventSource:w,event_types:g}=await o("@script"),v=(0,a.memo)(function({entity:e,index:t,isSelected:i,style:n,onClick:a}){return(0,s.jsx)("div",{style:n,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",id:`character-button-${e.id}`,title:e.item?.name||e.id,children:(0,s.jsx)(y,{entity:e,index:t,isSelected:i,onSelect:a})})},(e,t)=>e.entity===t.entity&&e.isSelected===t.isSelected&&e.onClick===t.onClick),S=({index:e,style:t,data:i})=>{const{entities:n,selectedIndex:a,handleItemClick:r}=i,c=n[e];return c?(0,s.jsx)(v,{index:e,entity:c,style:t,isSelected:a===e,onClick:r}):(0,s.jsx)("div",{style:t,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",children:(0,s.jsx)(x,{onClick:()=>{}})})},j=({entities:e})=>{const[t,i]=(0,a.useState)(null),{searchQuery:n}=(0,l.SQ)(),o=(0,a.useCallback)(async()=>{i(null),await p(),await w.emit("DISCORDIA_HOME_BUTTON_CLICKED")},[]),u=(0,a.useCallback)(async(e,t)=>{i(t);try{if("group"===e.type){const t=e.id.toString();if(!SillyTavern.getContext().groups.find(e=>e.id.toString()===t))return;await p();const i=await m(t);await(0,c.eS)({group:e,chat_id:i[0]?.file_id})}else{const t=_.findIndex(t=>t.avatar===e?.item?.avatar);if(-1===t)return;await p();const i=await f(t);await(0,c.yG)(t,i[0]?.file_id)}}catch(e){console.error("Error selecting entity:",e)}},[]);(0,a.useEffect)(()=>{h()},[e]);const h=(0,a.useCallback)(()=>{const{characterId:t,groupId:n}=SillyTavern.getContext();if(null!=n){const t=e.findIndex(e=>"group"===e.type&&e.id.toString()===n.toString());i(-1!==t?t:null)}else if(void 0!==t&&parseInt(t)>=0){const n=e.findIndex(e=>"character"===e.type&&e.id.toString()===t.toString());i(-1!==n?n:null)}else i(null)},[e]);(0,a.useEffect)(()=>(w.on(g.CHAT_CHANGED,h),()=>{w.removeListener(g.CHAT_CHANGED,h)}),[h]);const y=(0,a.useMemo)(()=>({entities:e,selectedIndex:t,handleItemClick:u}),[e,u]),j=(0,a.useMemo)(()=>n?e.filter(e=>(e.item?.name||"").toLowerCase().includes(n.toLowerCase())):e,[e,n]);return(0,s.jsx)(d.A,{children:(0,s.jsxs)("div",{id:"character-container",children:[(0,s.jsxs)("div",{id:"characters-header",children:[(0,s.jsx)(C,{onClick:o}),(0,s.jsx)("div",{id:"characters-divider",className:"divider"})]}),(0,s.jsx)("div",{id:"characters-list",className:"pt-0.5",children:j.length<50?(0,s.jsxs)(s.Fragment,{children:[j.map(i=>{const n=e.indexOf(i);return(0,s.jsx)(v,{entity:i,index:n,isSelected:t===n,onClick:u,style:{}},i.id.toString())}),(0,s.jsx)("div",{id:"characters-divider",className:"divider"}),(0,s.jsx)(x,{onClick:()=>{}})]}):(0,s.jsx)(r.B8,{rowComponent:S,rowCount:j.length+1,rowHeight:60,rowProps:{data:y},style:{width:"100%"},overscanCount:5})})]})})},k=(0,a.memo)(j);n()}catch(e){n(e)}},1)}};
//# sourceMappingURL=457.bundle.js.map