export const __webpack_esm_id__=918;export const __webpack_esm_ids__=[918];export const __webpack_esm_modules__={4918:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>g});var n=t(2714),r=t(9378),o=t(1363),c=t(7233),i=t(7257).V,l=e([c]),u=l.then?(await l)():l;c=u[0];const d=(0,r.lazy)(()=>t.e(951).then(t.bind(t,1951))),m=(0,r.lazy)(()=>t.e(108).then(t.bind(t,108))),p=(0,r.lazy)(()=>t.e(917).then(t.bind(t,2917))),{eventSource:h,event_types:v}=await i("@script"),x=({icons:e=null})=>{const[a,t]=(0,r.useState)("no_connection"),{openPage:s}=(0,r.useContext)(o.N);(0,r.useEffect)(()=>(h.on(v.ONLINE_STATUS_CHANGED,i),()=>{h.removeListener(v.ONLINE_STATUS_CHANGED,i)}),[]);const i=(0,r.useCallback)(()=>{"no_connection"===SillyTavern.getContext().onlineStatus?t("no_connection"):t("online")},[]),l=(0,r.useCallback)(e=>{const a=e.id;switch(a){case"#user-settings-button":s((0,n.jsx)(d,{}));break;case"#ai-config-button":s((0,n.jsx)(m,{}));break;case"#sys-settings-button":s((0,n.jsx)(p,{}));break;default:console.log(`No action defined for icon with id: ${a}`)}},[]),u=(0,r.useMemo)(()=>"no_connection"!==a,[a]),x=(0,r.useMemo)(()=>e?.filter(e=>e.showInProfile)||[],[e]);return(0,n.jsxs)("div",{id:"user-profile-container",children:[(0,n.jsx)(c.A,{}),(0,n.jsx)("div",{id:"user-settings-buttons",children:x.map((e,a)=>(0,n.jsx)(f,{apiConnected:u,icon:e,onClick:l},a))})]})},f=({icon:e,onClick:a,apiConnected:t=!1,enabled:s=!0})=>{const o=(0,r.useMemo)(()=>e.className.includes("fa-plug"),[e.className]),c=(0,r.useMemo)(()=>t?e.className.replace("redOverlayGlow","").replace("fa-plug-circle-exclamation","fa-plug"):`${e.className}`,[t,e.className]),i=(0,r.useCallback)(()=>{a&&s&&a(e)},[a,s,e]);return o?(0,n.jsx)("div",{className:c,title:e.title,onClick:i}):(0,n.jsx)("div",{className:e.className,title:e.title,onClick:i})},g=(0,r.memo)(x);s()}catch(e){s(e)}},1)},4981:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{A:()=>l});var n=t(2714),r=t(9378),o=t(7257).V;const{getThumbnailUrl:e}=await o("@script"),c=({personas:e,onSelect:a})=>{const t=(0,r.useMemo)(()=>[...e].sort((e,a)=>e.avatar.localeCompare(a.avatar)),[e]);if(!t.length)return(0,n.jsx)("div",{className:"p-3 text-sm text-gray-300",children:"No personas available"});const s=(0,r.useCallback)(e=>{a&&a(e)},[a]);return(0,n.jsx)("div",{className:"max-h-64 w-64 overflow-y-auto rounded-md border border-gray-700 bg-base-discordia shadow-lg",children:t.map(e=>(0,n.jsx)(i,{persona:e,onClick:s},e.avatar))})},i=(0,r.memo)(function({persona:a,onClick:t}){const s=(0,r.useMemo)(()=>e("persona",a.avatar||"user-default.png"),[a]),o=(0,r.useCallback)(()=>{t&&t(a)},[t,a]);return(0,n.jsxs)("button",{className:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm hover:bg-lighter transition-colors",onClick:o,children:[(0,n.jsx)("img",{loading:"lazy",src:s,alt:a.name,className:"h-8 w-8 rounded-full object-cover"}),(0,n.jsx)("span",{className:"truncate",children:a.name})]},a.avatar)}),l=(0,r.memo)(c);s()}catch(e){s(e)}},1)},7233:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{A:()=>v});var n=t(2714),r=t(9378),o=t(7611),c=t(7552),i=t(4981),l=t(7257).V,u=e([c,i]);[c,i]=u.then?(await u)():u;const{getThumbnailUrl:d}=await l("@script"),{getUserAvatars:m,setUserAvatar:p}=await l("@scripts/personas"),{power_user:h}=await l("@scripts/powerUser"),v=()=>{const[e,a]=(0,r.useState)([]),[t,s]=(0,r.useState)(!1),[l,u]=(0,r.useState)(null),v=(0,r.useRef)(null),{showContextMenu:x}=(0,r.useContext)(o.Kh),f=(0,r.useCallback)(()=>{(0,c.r)().catch(e=>{console.error("Error during logout:",e)})},[]),g=(0,r.useCallback)(()=>{s(e=>!e)},[]),b=(0,r.useCallback)(e=>{e.preventDefault(),x(e,[{label:"Log Out",variant:"danger",onClick:f}])},[x,f]);(0,r.useEffect)(()=>{(async()=>{try{const e=await m(),t=e.map(e=>h.personas[e]||e);a(e.map((e,a)=>({name:t[a],avatar:e})))}catch(e){console.error("Error fetching user personas:",e)}})()},[h]),(0,r.useEffect)(()=>{if(!t)return;const e=e=>{v.current&&!v.current.contains(e.target)&&s(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[t]);const w=(0,r.useCallback)(e=>{s(!1),p(e.avatar,{toastPersonaNameChange:!0}).catch(e=>{console.error("Error setting user avatar:",e)}),u(e)},[]),C=(0,r.useMemo)(()=>h.personas[l?.avatar||"user-default.png"]||e.find(e=>e.avatar===l?.avatar)?.name||"User",[l,e,h]),N=(0,r.useMemo)(()=>d("persona",l?.avatar||"user-default.png"),[l]);return(0,n.jsxs)("div",{className:"relative w-full",ref:v,children:[(0,n.jsxs)("div",{id:"profile-persona-container",className:"hover:bg-lighter select-none w-full cursor-pointer flex items-center rounded-md transition-colors ease-in-out",onContextMenu:b,onClick:g,children:[(0,n.jsx)("div",{id:"user-avatar",className:"mx-1 h-10 w-10 shrink-0 flex items-center justify-center",children:(0,n.jsx)("img",{loading:"lazy",id:"discordia-avatar",src:N,style:{width:"36px",height:"36px",borderRadius:"50%",objectFit:"cover",cursor:"pointer"},alt:"User Avatar"})}),(0,n.jsxs)("div",{id:"user-info",children:[" ",(0,n.jsx)("div",{id:"user-name",className:"select-none",children:C}),(0,n.jsx)("div",{id:"user-status"})]})]}),t&&e.length>0&&(0,n.jsx)("div",{className:"absolute bottom-[calc(100%+8px)] left-0 z-50",children:(0,n.jsx)(i.A,{personas:e,onSelect:w})})]})};s()}catch(e){s(e)}},1)},7552:(e,a,t)=>{t.a(e,async(e,s)=>{try{t.d(a,{r:()=>o});var n=t(7257).V;const{getRequestHeaders:r}=await n("@script");async function o(){await fetch("/api/users/logout",{method:"POST",headers:r({omitContentType:!0})});const e=new URLSearchParams(window.location.search);e.set("noauto","true"),window.location.search=e.toString()}s()}catch(c){s(c)}},1)}};
//# sourceMappingURL=918.bundle.js.map