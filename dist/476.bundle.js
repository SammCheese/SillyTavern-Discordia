export const __webpack_esm_id__=476;export const __webpack_esm_ids__=[476];export const __webpack_esm_modules__={5476:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>j});var s=i(2714),a=i(9378),r=i(1833),c=i(675),l=i(2875),d=i(7257).V,o=e([c]),u=o.then?(await o)():o;c=u[0];const h=(0,a.lazy)(()=>i.e(800).then(i.bind(i,3800))),y=(0,a.lazy)(()=>i.e(959).then(i.bind(i,9959))),x=(0,a.lazy)(()=>i.e(824).then(i.bind(i,2824))),{getGroupPastChats:C}=await d("@scripts/groupChats"),{getPastCharacterChats:m,characters:f,closeCurrentChat:_,eventSource:p,event_types:w}=await d("@script"),g=(0,a.memo)(function({entity:e,index:t,isSelected:i,style:n,onClick:a}){return(0,s.jsx)("div",{style:n,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",id:`character-button-${e.id}`,title:e.item?.name||e.id,children:(0,s.jsx)(h,{entity:e,index:t,isSelected:i,onSelect:a})})},(e,t)=>e.entity===t.entity&&e.isSelected===t.isSelected&&e.onClick===t.onClick),v=({index:e,style:t,data:i})=>{const{entities:n,selectedIndex:a,handleItemClick:r}=i,c=n[e];return c?(0,s.jsx)(g,{index:e,entity:c,style:t,isSelected:a===e,onClick:r}):(0,s.jsx)("div",{style:t,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",children:(0,s.jsx)(y,{onClick:()=>{}})})},S=({entities:e})=>{const[t,i]=(0,a.useState)(null),{searchQuery:n}=(0,l.SQ)(),d=(0,a.useCallback)(async()=>{i(null),await _(),await p.emit("DISCORDIA_HOME_BUTTON_CLICKED")},[]),o=(0,a.useCallback)(async(e,t)=>{i(t);try{if("group"===e.type){const t=e.id.toString();if(!SillyTavern.getContext().groups.find(e=>e.id.toString()===t))return;await _();const i=await C(t);await(0,c.eS)({group:e,chat_id:i[0]?.file_id})}else{const t=f.findIndex(t=>t.avatar===e?.item?.avatar);if(-1===t)return;await _();const i=await m(t);await(0,c.yG)(t,i[0]?.file_id)}}catch(e){console.error("Error selecting entity:",e)}},[]);(0,a.useEffect)(()=>{u()},[e]);const u=(0,a.useCallback)(()=>{const{characterId:t,groupId:n}=SillyTavern.getContext();if(null!=n){const t=e.findIndex(e=>"group"===e.type&&e.id.toString()===n.toString());i(-1!==t?t:null)}else if(void 0!==t&&parseInt(t)>=0){const n=e.findIndex(e=>"character"===e.type&&e.id.toString()===t.toString());i(-1!==n?n:null)}else i(null)},[e]);(0,a.useEffect)(()=>(p.on(w.CHAT_CHANGED,u),()=>{p.removeListener(w.CHAT_CHANGED,u)}),[u]);const h=(0,a.useMemo)(()=>({entities:e,selectedIndex:t,handleItemClick:o}),[e,o]),S=(0,a.useMemo)(()=>n?e.filter(e=>(e.item?.name||"").toLowerCase().includes(n.toLowerCase())):e,[e,n]);return(0,s.jsxs)("div",{id:"character-container",children:[(0,s.jsxs)("div",{id:"characters-header",children:[(0,s.jsx)(x,{onClick:d}),(0,s.jsx)("div",{id:"characters-divider",className:"divider"})]}),(0,s.jsx)("div",{id:"characters-list",className:"pt-0.5",children:S.length<50?(0,s.jsxs)(s.Fragment,{children:[S.map(i=>{const n=e.indexOf(i);return(0,s.jsx)(g,{entity:i,index:n,isSelected:t===n,onClick:o,style:{}},i.id.toString())}),(0,s.jsx)("div",{id:"characters-divider",className:"divider"}),(0,s.jsx)(y,{onClick:()=>{}})]}):(0,s.jsx)(r.B8,{rowComponent:v,rowCount:S.length+1,rowHeight:60,rowProps:{data:h},style:{width:"100%"},overscanCount:5})})]})},j=(0,a.memo)(S);n()}catch(e){n(e)}},1)}};
//# sourceMappingURL=476.bundle.js.map