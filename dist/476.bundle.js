"use strict";(self.webpackChunkst_discordia=self.webpackChunkst_discordia||[]).push([[476],{476:(e,t,n)=>{n.a(e,async(e,i)=>{try{n.r(t),n.d(t,{default:()=>S});var a=n(363),r=n(636),c=n(675),l=n(257).V,s=e([c]),d=s.then?(await s)():s;c=d[0];const o=a.lazy(()=>n.e(800).then(n.bind(n,800))),u=a.lazy(()=>n.e(959).then(n.bind(n,959))),y=a.lazy(()=>n.e(824).then(n.bind(n,824))),{getGroupPastChats:h}=await l("@scripts/groupChats"),{getPastCharacterChats:m,characters:f,closeCurrentChat:g}=await l("@script"),p=a.memo(function({entity:e,index:t,isSelected:n,style:i,onClick:r}){return a.createElement("div",{style:i,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1",id:`character-button-${e.id}`,title:e.item?.name||e.id},a.createElement(o,{entity:e,index:t,isSelected:n,onSelect:r}))}),C=({entities:e})=>{const[t,n]=a.useState(null),i=(0,a.useCallback)(async()=>{n(null),await g()},[]),l=a.useCallback(async(e,t)=>{n(t);try{if("group"===e.type){const t=e.id.toString();if(!SillyTavern.getContext().groups.find(e=>e.id.toString()===t))return;await g();const n=await h(t);await(0,c.eS)({group:e,chat_id:n[0]?.file_id})}else{const t=f.findIndex(t=>t.avatar===e?.item?.avatar);if(-1===t)return;await g();const n=await m(t);await(0,c.yG)(t,n[0]?.file_id)}}catch(e){console.error("Error selecting entity:",e)}},[]);a.useEffect(()=>{const{characterId:t,groupId:i}=SillyTavern.getContext();let a=null;if(null!=i){const t=e.findIndex(e=>"group"===e.type&&e.id.toString()===i.toString());a=-1!==t?t:null}else if(void 0!==t&&parseInt(t)>=0){const n=e.findIndex(e=>"character"===e.type&&e.id.toString()===t.toString());a=-1!==n?n:null}else a=null;n(a)},[e]),a.useEffect(()=>{const{characterId:t,groupId:i}=SillyTavern.getContext();if(i){const t=e.findIndex(e=>"group"===e.type&&e.id.toString()===i.toString());n(-1!==t?t:null)}else if(t){const i=e.findIndex(e=>"character"===e.type&&e.id.toString()===t.toString());n(-1!==i?i:null)}else n(null)},[e]);return a.createElement("div",{id:"character-container"},a.createElement("div",{id:"characters-header"},a.createElement(y,{onClick:i}),a.createElement("div",{id:"characters-divider",className:"divider"})),a.createElement("div",{id:"characters-list",className:"pt-0.5"},e.length<50?a.createElement(a.Fragment,null,e.map((e,n)=>a.createElement(p,{key:e.id.toString(),entity:e,index:n,isSelected:t===n,onClick:l,style:{}})),a.createElement("div",{id:"characters-divider",className:"divider"}),a.createElement(u,{onClick:()=>{}})):a.createElement(r.B8,{rowComponent:({index:n,style:i})=>{const r=e[n];return r?a.createElement(p,{index:n,entity:r,style:i,isSelected:t===n,onClick:l}):a.createElement("div",{style:i,className:"discord-entity-item character-button w-full h-fit flex justify-center py-1"},a.createElement(u,{onClick:()=>{}}))},rowCount:e.length+1,rowHeight:60,rowProps:{},style:{width:"100%"},overscanCount:5})))},S=a.memo(C);i()}catch(e){i(e)}},1)}}]);
//# sourceMappingURL=476.bundle.js.map