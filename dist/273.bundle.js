export const __webpack_esm_id__=273;export const __webpack_esm_ids__=[273,722];export const __webpack_esm_modules__={855(e,a,s){s.a(e,async(e,l)=>{try{s.d(a,{A:()=>d});var r=s(5656),t=s(7140),n=s(6553),o=e([n]),c=o.then?(await o)():o;n=c[0];const i=({members:e,onOrderChange:a,onRemoveMember:s,onOpenMemberProfile:l})=>(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"flex flex-col gap-2",children:e&&e.map((e,t)=>(0,r.jsx)(n.A,{character:e,type:"member",onOrderChange:a,onRemove:s,onOpenProfile:l},e.avatar||t))})}),d=(0,t.memo)(i);l()}catch(e){l(e)}})},3355(e,a,s){s.a(e,async(e,l)=>{try{s.d(a,{A:()=>x});var r=s(5656),t=s(7140),n=s(6553),o=s(7722),c=s(5277),i=e([n]),d=i.then?(await i)():i;n=d[0];const m=(0,t.memo)(function({index:e,style:a,character:s,onGroupAdd:l}){return s?(0,r.jsx)("div",{style:a,children:(0,r.jsx)(n.A,{character:s,type:"character",onGroupAdd:l})},s.avatar||e):null}),u=({index:e,style:a,data:s,onGroupAdd:l})=>{const n=s[e],o=(0,t.useCallback)(()=>{n&&l(n)},[n,l]);return n?(0,r.jsx)(m,{index:e,character:n,style:a,onGroupAdd:o}):(0,r.jsx)("div",{style:a,onClick:o,children:"Loading..."})},h=({onAdd:e,existingMembers:a})=>{const s=SillyTavern.getContext().characters,l=(0,t.useMemo)(()=>s.filter(e=>!a.find(a=>a.avatar===e.avatar)),[s,a]),[i,d]=(0,t.useState)(l),m=(0,t.useCallback)(a=>{e(a)},[e]),h=(0,t.useCallback)(e=>{const a=l.filter(a=>{const s=e.toLowerCase();return a.name.toLowerCase().includes(s)||a.description.toLowerCase().includes(s)});d(a)},[l]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{children:(0,r.jsx)(o.default,{onInput:h})}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 mt-4 h-96 overflow-y-auto",children:[0===i.length&&(0,r.jsx)("div",{className:"text-center text-sm text-gray-500",children:"Looks like everyone's already in the group!"}),i.length>20?(0,r.jsx)(c.B8,{rowComponent:u,rowCount:i.length,rowHeight:60,rowProps:{data:i,onGroupAdd:m},style:{width:"100%",marginBottom:"8px"},overscanCount:5}):i.map((e,a)=>(0,r.jsx)(n.A,{character:e,onGroupAdd:m,type:"character"},e.avatar||a))]})]})},x=(0,t.memo)(h);l()}catch(e){l(e)}})},6553(e,a,s){s.a(e,async(e,l)=>{try{s.d(a,{A:()=>c});var r=s(5656),t=s(7140),n=s(3659).V;const{getThumbnailUrl:e}=await n("@script"),o=({character:a,onRemove:s,onOpenProfile:l,onOrderChange:n,onGroupAdd:o,type:c="character"})=>{const i=(0,t.useMemo)(()=>e("avatar",a.avatar||"default_Assistant.png"),[a]),d=(0,t.useCallback)(e=>{e.stopPropagation(),s&&s(a)},[s,a]),m=(0,t.useCallback)(e=>{e.stopPropagation(),l&&l(a)},[l,a]),u=(0,t.useCallback)(e=>{e.stopPropagation(),n&&n(a,"up")},[n,a]),h=(0,t.useCallback)(e=>{e.stopPropagation(),n&&n(a,"down")},[n,a]),x=(0,t.useCallback)(e=>{e.stopPropagation(),o&&o(a)},[o,a]),p=(0,t.useMemo)(()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1 w-6 items-center",children:[(0,r.jsx)("div",{children:(0,r.jsx)("div",{title:"Move Up",className:"fa fa-solid fa-arrow-up cursor-pointer",onClick:u})}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{title:"Move Down",className:"fa fa-solid fa-arrow-down cursor-pointer",onClick:h})})]}),(0,r.jsx)("div",{className:"flex flex-col gap-1 w-6 items-center",children:(0,r.jsx)("div",{title:"Open Character Card",className:"fa fa-solid fa-user cursor-pointer",onClick:m})}),(0,r.jsx)("div",{className:"flex flex-col gap-1 w-6 items-center",children:(0,r.jsx)("div",{title:"Remove Member",className:"fa fa-solid fa-trash cursor-pointer text-red-500",onClick:d})})]}),[u,h,m,d]),f=(0,t.useMemo)(()=>(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"flex flex-col gap-1 w-6 items-center",children:(0,r.jsx)("div",{title:"Add to Group",className:"fa fa-solid fa-plus cursor-pointer",onClick:x})})}),[x]);return(0,r.jsxs)("div",{className:"flex flex-row items-center gap-4 p-2 border rounded-md border-base-discordia-lighter hover:bg-lighter",children:[(0,r.jsx)("div",{className:"w-10 h-10 min-w-10 min-h-10",children:(0,r.jsx)("img",{loading:"lazy",src:i,alt:a.name||"Member Avatar",className:"w-full h-full rounded-full object-cover"})}),(0,r.jsxs)("div",{className:"flex flex-col w-full min-w-0 overflow-hidden",children:[(0,r.jsx)("span",{className:"font-medium",children:a.name||"Unnamed Member"}),(0,r.jsxs)("span",{className:"text-sm text-gray-500 truncate",children:["Tags: ",a.tags.join(", ")||"None"]})]}),(0,r.jsx)("div",{className:"ml-auto flex flex-row gap-2 items-center",children:"member"===c?p:f})]})},c=(0,t.memo)(o);l()}catch(e){l(e)}},1)},7200(e,a,s){s.d(a,{A:()=>t});var l=s(5656),r=s(7140);const t=(0,r.memo)(({label:e,checked:a=!1,onChange:s})=>{const[t,n]=(0,r.useState)(a),o=(0,r.useCallback)(e=>{e.stopPropagation();const a=!t;n(a),s&&s(a)},[t,s]);return(0,r.useEffect)(()=>{n(a)},[a]),(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsxs)("label",{className:"inline-flex items-center cursor-pointer relative",children:[(0,l.jsx)("input",{type:"checkbox",className:"appearance-none opacity-0 w-6 h-6 left-0 m-0 p-0 top-0",style:{height:"24px !important",width:"24px !important",position:"absolute"},checked:t,onChange:o}),(0,l.jsx)("div",{className:`w-6 h-6  rounded flex items-center justify-center cursor-pointer ${t?"border-blurple":"border-white"} hover:border-blurple border-2`,style:{backgroundColor:t?"var(--color-blurple)":"transparent",border:t?"none":"2px solid var(--color-white)",transition:"all 0.2s ease-in-out"},children:(0,l.jsx)("svg",{"aria-hidden":"true",role:"img",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{fill:t?"white":"transparent",fillRule:"evenodd",d:"M19.06 6.94a1.5 1.5 0 0 1 0 2.12l-8 8a1.5 1.5 0 0 1-2.12 0l-4-4a1.5 1.5 0 0 1 2.12-2.12L10 13.88l6.94-6.94a1.5 1.5 0 0 1 2.12 0Z",clipRule:"evenodd"})})}),(0,l.jsx)("span",{className:"ml-2 text-gray-200",children:e})]})})})},7242(e,a,s){s.d(a,{A:()=>t});var l=s(5656),r=s(7140);const t=(0,r.memo)(({options:e=[],value:a,onChange:s,disabled:t})=>{const n=(0,r.useCallback)(e=>{s&&s(e.target.value)},[s]);return(0,l.jsx)("select",{className:"border border-gray-300 rounded bg-white disabled:bg-gray-100 disabled:cursor-not-allowed",value:a,onChange:n,disabled:t,children:e.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})})},7722(e,a,s){s.r(a),s.d(a,{default:()=>n});var l=s(5656),r=s(7140);const t=(0,r.lazy)(()=>s.e(552).then(s.bind(s,2552))),n=(0,r.memo)(({onInput:e,style:a,onIconClick:s})=>{const[n,o]=(0,r.useState)(""),c=(0,r.useCallback)(a=>{o(a),e(a)},[e]),i=(0,r.useCallback)(()=>{s&&s()},[s]);return(0,l.jsxs)("div",{id:"search-bar-container",className:" relative p-1 mx-2 flex content-center gap-2 bg-input-bg rounded-md items-baseline flex-row",style:a,children:[(0,l.jsx)(t,{placeholder:"Search",value:n,onChange:c}),(0,l.jsx)("div",{className:"fa-solid fa-magnifying-glass content-center cursor-pointer w-5 h-5 hover:opacity-100 opacity-70 absolute right-3 top-1/2 transform -translate-y-1/2",onClick:i})]})})},8273(e,a,s){s.a(e,async(e,l)=>{try{s.r(a),s.d(a,{default:()=>M});var r=s(5656),t=s(7140),n=s(8586),o=s(726),c=s(9879),i=s(2552),d=s(8466),m=s(1608),u=s(7242),h=s(7200),x=s(7264),p=s(855),f=s(9676),v=s(3355),b=s(2711),g=s(869),j=s(1724),w=s(3659).V,C=e([d,p,f,v,g]);[d,p,f,v,g]=C.then?(await C)():C;const{deleteGroup:y,hideMutedSprites:k,is_group_automode_enabled:N}=await w("@scripts/groupChats"),{eventSource:A}=await w("@script"),{getContext:_}=SillyTavern,M=({entity:e})=>{const[a,s]=(0,t.useState)(e.item||null),[l,w]=(0,t.useState)(!1),[C,M]=(0,t.useState)(N),[S,O]=(0,t.useState)(k),{closeModal:G,openModal:P}=(0,c.hS)(),R=(0,t.useCallback)(()=>{G()},[G]),I=(0,t.useCallback)(async()=>{e?.id&&(await y(e.id.toString()),G())},[e,G]),T=(0,t.useCallback)(async()=>{if(e?.id&&a){w(!0);try{const s=_().groups.findIndex(a=>a.id===e.id);-1!==s&&(_().groups[s]=a),await(0,f.B)(a,!0),C!==N&&$("#rm_group_automode").prop("checked",C).trigger("change"),S!==k&&$("#rm_group_hidemutedsprites").prop("checked",S).trigger("change"),S!==k&&SillyTavern.getContext().setHideMutedSprites(S),await A.emit(b.V.ENTITY_CHANGED),G()}catch(e){console.error("Error saving group:",e)}finally{w(!1)}}},[e,a,G,C,S]),E=(0,t.useCallback)(e=>{s(a=>a?{...a,name:e}:a)},[]),H=(0,t.useCallback)((e,a)=>{s(s=>s?{...s,[e]:a}:s)},[]),L=(0,t.useCallback)(()=>{s(e=>e?{...e,fav:!e.fav}:e)},[]),B=(0,t.useCallback)(e=>{P((0,r.jsx)(g.default,{type:"edit",avatarName:e.avatar||""}))},[P]),D=(0,t.useCallback)(e=>{const l=(a?.members||[]).filter(a=>a!==e.avatar);s(e=>e?{...e,members:l}:e)},[a?.members,s]),F=(0,t.useCallback)(e=>{const l=a?.members||[];if(e.avatar&&l.includes(e.avatar))return;const r=[...l,e.avatar||""];s(e=>e?{...e,members:r}:e)},[a?.members,s]),V=(0,t.useMemo)(()=>{if(!a?.members)return[];const e=[];for(const s of a.members){if(!s)continue;const a=_().characters.find(e=>e.avatar===s);a&&e.push(a)}return e},[a?.members]),J=(0,t.useMemo)(()=>!a||(!!l||""===a.name.trim()),[a,l]),U=(0,t.useCallback)(e=>{H("generation_mode",parseInt(e))},[H]),z=(0,t.useCallback)(e=>{H("activation_strategy",parseInt(e))},[H]),q=(0,t.useCallback)(e=>{H("allow_self_responses",e)},[H]),Y=(0,t.useCallback)(e=>{H("auto_mode_delay",parseInt(e))},[H]),Z=(0,t.useCallback)(e=>{M(e)},[M]),K=(0,t.useCallback)(e=>{O(e)},[O]);return(0,r.jsxs)(o.A,{children:[(0,r.jsx)(o.A.Header,{children:"Edit Group"}),(0,r.jsxs)(o.A.Content,{children:[(0,r.jsxs)("div",{className:"flex flex-row gap-4 items-center w-full p-6",children:[(0,r.jsx)("div",{className:"shrink-0 w-20 h-20",children:(0,r.jsx)(d.A,{groupItem:e.item,width:80,height:80,rounded:!0})}),(0,r.jsxs)("div",{className:"flex flex-row justify-between items-center w-full",children:[(0,r.jsxs)("div",{className:"flex flex-col w-full relative",children:[(0,r.jsx)("label",{className:"block mb-2 font-medium absolute -top-6 ",children:"Group Name"}),(0,r.jsx)(i.default,{value:a?.name||"",onChange:E})]}),(0,r.jsx)("div",{className:"ms-2",children:(0,r.jsx)(j.A,{faIcon:"fa fa-solid fa-star",color:a?.fav?"yellow":"white",onClick:L})})]})]}),(0,r.jsx)(m.default,{className:"my-4"}),(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col  gap-2",children:[(0,r.jsx)("label",{className:"block mb-2 font-medium",children:"Member Order:"}),(0,r.jsx)(u.A,{value:a.activation_strategy,options:[{label:"Manual",value:2},{label:"Natural order",value:0},{label:"List Order",value:1},{label:"Pooled Order",value:3}],onChange:z})]}),(0,r.jsxs)("div",{className:"flex flex-col  gap-2",children:[(0,r.jsx)("label",{className:"block mb-2 font-medium",children:"Generation Handling:"}),(0,r.jsx)(u.A,{value:a.generation_mode,options:[{label:"Swap character cards",value:0},{label:"Join character cards (exclude muted)",value:1},{label:"Join character cards (include muted)",value:2}],onChange:U})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(h.A,{label:"Allow Self responses",checked:a.allow_self_responses,onChange:q}),(0,r.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,r.jsx)(h.A,{label:"Auto Mode",checked:N,onChange:Z}),(0,r.jsx)(i.default,{type:"number",placeholder:"5",value:a.auto_mode_delay,onChange:Y})]}),(0,r.jsx)(h.A,{label:"Hide Muted Members Sprites",checked:k,onChange:K})]}),(0,r.jsx)("div",{children:(0,r.jsx)(x.default,{title:"Current Members",children:(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)(p.A,{members:V,onOrderChange:(e,l)=>{const r=a?.members||[],t=r.indexOf(e.avatar||"");if(-1===t)return;const n="up"===l?t-1:t+1;if(n<0||n>=r.length)return;const o=[...r],c=o[t];o[t]=o[n]??"",o[n]=c??"",s(e=>e?{...e,members:o}:e)},onRemoveMember:D,onOpenMemberProfile:B})})})}),(0,r.jsx)("div",{children:(0,r.jsx)(x.default,{title:"Add Members",children:(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsx)(v.A,{onAdd:F,existingMembers:V})})})})]})]}),(0,r.jsxs)(o.A.Footer,{children:[(0,r.jsx)("div",{className:"grow",children:(0,r.jsx)(n.A,{look:n.m.DANGER,onClick:I,children:"Delete"})}),(0,r.jsx)(n.A,{look:n.m.TRANSPARENT,onClick:R,children:"Cancel"}),(0,r.jsx)(n.A,{onClick:T,disabled:J,children:"Save"})]})]})};l()}catch(e){l(e)}},1)},9676(e,a,s){s.a(e,async(e,l)=>{try{s.d(a,{B:()=>o});var r=s(3659).V;const{getRequestHeaders:t,getCharacters:n}=await r("@script");async function o(e,a=!0){await fetch("/api/groups/edit",{method:"POST",headers:t(),body:JSON.stringify(e)}),a&&await n()}l()}catch(c){l(c)}},1)}};
//# sourceMappingURL=273.bundle.js.map