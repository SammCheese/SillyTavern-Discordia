export const __webpack_esm_id__=219;export const __webpack_esm_ids__=[219];export const __webpack_esm_modules__={4181(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{r:()=>o});var n=t(5822).V;const{getRequestHeaders:r}=await n("@script");async function o(){await fetch("/api/users/logout",{method:"POST",headers:r({omitContentType:!0})});const e=new URLSearchParams(window.location.search);e.set("noauto","true"),window.location.search=e.toString()}s()}catch(c){s(c)}},1)},7600(e,a,t){t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>g});var n=t(5656),r=t(7140),o=t(1826),c=t(8808),l=t(5822).V,i=e([o,c]);[o,c]=i.then?(await i)():i;const u=(0,r.lazy)(()=>t.e(818).then(t.bind(t,2818))),d=(0,r.lazy)(()=>t.e(319).then(t.bind(t,4319))),m=(0,r.lazy)(()=>t.e(816).then(t.bind(t,816))),{eventSource:p,event_types:h}=await l("@script"),f=({icons:e=null})=>{const[a,t]=(0,r.useState)("no_connection"),{openPage:s}=(0,r.useContext)(o.N);(0,r.useEffect)(()=>(p.on(h.ONLINE_STATUS_CHANGED,l),()=>{p.removeListener(h.ONLINE_STATUS_CHANGED,l)}),[]);const l=(0,r.useCallback)(()=>{"no_connection"===SillyTavern.getContext().onlineStatus?t("no_connection"):t("online")},[]),i=(0,r.useCallback)(e=>{const a=e.id;switch(a){case"#user-settings-button":s((0,n.jsx)(u,{}));break;case"#ai-config-button":s((0,n.jsx)(d,{}));break;case"#sys-settings-button":s((0,n.jsx)(m,{}));break;default:console.log(`No action defined for icon with id: ${a}`)}},[]),f=(0,r.useMemo)(()=>"no_connection"!==a,[a]),g=(0,r.useMemo)(()=>e?.filter(e=>e.showInProfile)||[],[e]);return(0,n.jsxs)("div",{id:"user-profile-container",children:[(0,n.jsx)(c.A,{}),(0,n.jsx)("div",{id:"user-settings-buttons",children:g.map((e,a)=>(0,n.jsx)(v,{apiConnected:f,icon:e,onClick:i},a))})]})},v=({icon:e,onClick:a,apiConnected:t=!1,enabled:s=!0})=>{const o=(0,r.useMemo)(()=>e.className.includes("fa-plug"),[e.className]),c=(0,r.useMemo)(()=>t?e.className.replace("redOverlayGlow","").replace("fa-plug-circle-exclamation","fa-plug"):`${e.className}`,[t,e.className]),l=[{id:"#user-settings-button",className:"drawer-icon fa-solid fa-gear fa interactable closedIcon"}],i=(0,r.useMemo)(()=>{const a=l.find(a=>a.id===e.id);return a?a.className:e.className},[e.className,e.id,l]),u=(0,r.useCallback)(()=>{a&&s&&a(e)},[a,s,e]);return o?(0,n.jsx)("div",{className:c,title:e.title,onClick:u}):(0,n.jsx)("div",{className:i,title:e.title,onClick:u})},g=(0,r.memo)(f);s()}catch(e){s(e)}},1)},8808(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{A:()=>f});var n=t(5656),r=t(7140),o=t(2295),c=t(4181),l=t(9114),i=t(5822).V,u=e([c,l]);[c,l]=u.then?(await u)():u;const{getThumbnailUrl:d}=await i("@script"),{getUserAvatars:m,setUserAvatar:p}=await i("@scripts/personas"),{power_user:h}=await i("@scripts/powerUser"),f=()=>{const[e,a]=(0,r.useState)([]),[t,s]=(0,r.useState)(!1),[i,u]=(0,r.useState)(null),f=(0,r.useRef)(null),{showContextMenu:v}=(0,r.useContext)(o.Kh),g=(0,r.useCallback)(()=>{(0,c.r)().catch(e=>{console.error("Error during logout:",e)})},[]),x=(0,r.useCallback)(()=>{s(e=>!e)},[]),b=(0,r.useCallback)(()=>{document.fullscreenElement?document.exitFullscreen().catch(e=>{console.error(`Error attempting to exit full-screen mode: ${e.message} (${e.name})`)}):document.documentElement.requestFullscreen().catch(e=>{console.error(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})},[document.fullscreenElement]),w=(0,r.useCallback)(e=>{e.preventDefault(),v(e,[{label:(document.fullscreenElement?"Exit":"Enter")+" Fullscreen",onClick:b},{label:"Log Out",variant:"danger",onClick:g}])},[v,g,b]);(0,r.useEffect)(()=>{(async()=>{try{const e=await m(),t=e.map(e=>h.personas[e]||e);a(e.map((e,a)=>({name:t[a],avatar:e})))}catch(e){console.error("Error fetching user personas:",e)}})()},[h]),(0,r.useEffect)(()=>{if(!t)return;const e=e=>{f.current&&!f.current.contains(e.target)&&s(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[t]);const C=(0,r.useCallback)(e=>{s(!1),p(e.avatar,{toastPersonaNameChange:!0}).catch(e=>{console.error("Error setting user avatar:",e)}),u(e)},[]),N=(0,r.useMemo)(()=>h.personas[i?.avatar||"user-default.png"]||e.find(e=>e.avatar===i?.avatar)?.name||"User",[i,e,h]),_=(0,r.useMemo)(()=>d("persona",i?.avatar||"user-default.png"),[i]);return(0,n.jsxs)("div",{className:"relative w-full",ref:f,children:[(0,n.jsxs)("div",{id:"profile-persona-container",className:"hover:bg-lighter select-none w-full cursor-pointer flex items-center rounded-md transition-colors ease-in-out",onContextMenu:w,onClick:x,children:[(0,n.jsx)("div",{id:"user-avatar",className:"mx-1 h-10 w-10 shrink-0 flex items-center justify-center",children:(0,n.jsx)("img",{loading:"lazy",id:"discordia-avatar",src:_,style:{width:"36px",height:"36px",borderRadius:"50%",objectFit:"cover",cursor:"pointer"},alt:"User Avatar"})}),(0,n.jsxs)("div",{id:"user-info",children:[" ",(0,n.jsx)("div",{id:"user-name",className:"select-none",children:N}),(0,n.jsx)("div",{id:"user-status"})]})]}),t&&e.length>0&&(0,n.jsx)("div",{className:"absolute bottom-[calc(100%+8px)] -left-1 z-50",children:(0,n.jsx)(l.A,{personas:e,onSelect:C})})]})};s()}catch(e){s(e)}},1)},9114(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{A:()=>i});var n=t(5656),r=t(7140),o=t(5822).V;const{getThumbnailUrl:e}=await o("@script"),c=({personas:e,onSelect:a})=>{const t=(0,r.useMemo)(()=>[...e].sort((e,a)=>e.avatar.localeCompare(a.avatar)),[e]);if(!t.length)return(0,n.jsx)("div",{className:"p-3 text-sm text-gray-300",children:"No personas available"});const s=(0,r.useCallback)(e=>{a&&a(e)},[a]);return(0,n.jsx)("div",{className:"max-h-64 w-64 overflow-y-auto rounded-md border border-gray-700 bg-base-discordia shadow-lg",children:t.map(e=>(0,n.jsx)(l,{persona:e,onClick:s},e.avatar))})},l=(0,r.memo)(function({persona:a,onClick:t}){const s=(0,r.useMemo)(()=>e("persona",a.avatar||"user-default.png"),[a]),o=(0,r.useCallback)(()=>{t&&t(a)},[t,a]);return(0,n.jsxs)("button",{className:"cursor-pointer flex w-full items-center gap-2 px-3 py-2 text-left text-sm hover:bg-lighter transition-colors",onClick:o,children:[(0,n.jsx)("img",{loading:"lazy",src:s,alt:a.name,className:"h-8 w-8 rounded-full object-cover"}),(0,n.jsx)("span",{className:"truncate",children:a.name})]},a.avatar)}),i=(0,r.memo)(c);s()}catch(e){s(e)}},1)}};
//# sourceMappingURL=219.bundle.js.map