export const __webpack_esm_id__=395;export const __webpack_esm_ids__=[395];export const __webpack_esm_modules__={391:(t,a,e)=>{e.a(t,async(t,r)=>{try{e.d(a,{p:()=>m});var n=e(363),o=e(675),s=e(257).V,i=t([o]),c=i.then?(await i)():i;o=c[0];const{getGroupPastChats:d}=await s("@scripts/groupChats"),{getEntitiesList:h,eventSource:l,event_types:u,getPastCharacterChats:p}=await s("@script"),g=[{name:"Backgrounds",id:"#backgrounds-button"},{name:"Persona Management",id:"#persona-management-button"},{name:"Character Selector",id:"#rightNavHolder"},{name:"Extensions Settings",id:"#extensions-settings-button"},{name:"Advanced Formatting",id:"#advanced-formatting-button"},{name:"World Info",id:"#WI-SP-button"}],m=()=>{const[t,a]=(0,n.useState)({open:!1,entities:[],chats:[],icons:[],isLoadingChats:!0,wantsHome:!1}),e=(0,n.useCallback)(t=>{a(a=>({...a,open:t}))},[]),r=(0,n.useCallback)(async()=>{a(t=>({...t,wantsHome:!0}))},[]),s=(0,n.useCallback)(async()=>{a(t=>({...t,isLoadingChats:!0}));const{characterId:t,groupId:e}=SillyTavern.getContext();let r=[];try{if(null!==e)r=await d(e.toString()),a(t=>({...t,chats:r,isLoadingChats:!1,wantsHome:!1}));else if(void 0!==t&&parseInt(t)>=0)r=await p(),a(t=>({...t,chats:r,isLoadingChats:!1,wantsHome:!1}));else{const t=h({doFilter:!0,doSort:!0});r=await(0,o.r8)(t),a(t=>({...t,chats:r,isLoadingChats:!1,wantsHome:!1}))}}catch(t){console.error("Error updating chat data:",t),a(t=>({...t,isLoadingChats:!1}))}},[]),i=(0,n.useCallback)(async()=>{const t=h({doFilter:!0,doSort:!0}),e=await(0,o.r8)(t);a(a=>({...a,chats:e,entities:t,open:!0,isLoadingChats:!1}))},[]),c=(0,n.useCallback)(()=>{const t=$("#top-settings-holder");if(!t.length)return;const e=[];t.children().each((t,a)=>{const r=$(a),n=`#${r.attr("id")}`,o=r.find(".drawer-icon");e.push({className:o.attr("class")||"",title:o.attr("title")||r.find(".drawer-toggle").attr("title")||"",showInProfile:!g.some(t=>t.id===n),id:n})}),t.attr("style","display: none !important;"),a(t=>({...t,icons:e}))},[]);return n.useEffect(()=>{c();const a=()=>{window.innerWidth>1e3&&!t.open&&e(!0)};l.on(u.APP_READY,i),l.on(u.CHAT_CHANGED,s),l.on(u.CHAT_DELETED,s),l.on(u.CHAT_CREATED,s),l.on(u.SETTINGS_UPDATED,a);const r=$("body");let n=0,o=0;const d=t=>{n=t.clientX??0},h=t=>{o=t.clientX??0},p=t=>{n=t.originalEvent?.touches[0]?.clientX??0},g=t=>{o=t.originalEvent?.touches[0]?.clientX??0},m=()=>{0!==n&&0!==o&&(o>n+100?e(!0):o<n-100&&window.innerWidth<=1e3&&e(!1),n=0,o=0)};return r&&(r.on("pointerdown",d),r.on("pointermove",h),r.on("touchstart",p),r.on("touchmove",g),r.on("touchend pointerup",m)),()=>{l.removeListener(u.APP_READY,i),l.removeListener(u.CHAT_CHANGED,s),l.removeListener(u.CHAT_DELETED,s),l.removeListener(u.CHAT_CREATED,s),l.removeListener(u.SETTINGS_UPDATED,a),r&&(r.off("pointerdown",d),r.off("pointermove",h),r.off("touchstart",p),r.off("touchmove",g),r.off("touchend pointerup",m))}},[]),{...t,setOpen:e,handleHomeClick:r}};r()}catch(t){r(t)}},1)},395:(t,a,e)=>{e.a(t,async(t,r)=>{try{e.r(a),e.d(a,{App:()=>l,default:()=>u});var n=e(259),o=e(363),s=e(841),i=e(391),c=e(402),d=t([i,c]);[i,c]=d.then?(await d)():d;const h=o.lazy(()=>e.e(96).then(e.bind(e,96))),l=()=>{const{open:t,setOpen:a,entities:e,chats:r,icons:o,isLoadingChats:d}=(0,i.p)();return(0,s.createPortal)((0,n.jsx)(h,{open:t,setOpen:a,entities:e,chats:r,icons:o,isLoadingChats:d}),c.o)},u=l;r()}catch(t){r(t)}})},675:(t,a,e)=>{e.a(t,async(t,r)=>{try{e.d(a,{eS:()=>T,r8:()=>S,yG:()=>E,yN:()=>A});e(259),e(363);var n=e(257).V;const{characters:o,getRequestHeaders:s,getThumbnailUrl:i,system_avatar:c,default_avatar:d,openCharacterChat:h,setActiveCharacter:l,setActiveGroup:u,getCurrentChatId:p,saveSettingsDebounced:g,selectCharacterById:m}=await n("@script"),{groups:f,openGroupById:v,openGroupChat:_}=await n("@scripts/groupChats"),{sortMoments:C,timestampToMoment:y,isDataURL:w}=await n("@scripts/utils");async function S(t,a=20){const e=await fetch("/api/chats/recent",{method:"POST",headers:s(),body:JSON.stringify({max:a})});if(!e.ok)return console.warn("Failed to fetch recent character chats"),[];const r=await e.json();if(!Array.isArray(r)||0===r.length)return[];const n=r.sort((t,a)=>C(y(t.last_mes),y(a.last_mes))).map(t=>({chat:t,character:o.find(a=>a.avatar===t.avatar),group:f.find(a=>a.id===t.group)})).filter(t=>t.character||t.group).filter(a=>{if(!t||0===t.length)return!0;return!!t.find(t=>a.character&&"character"===t.type&&t.item.avatar.toString()===a.character.avatar.toString()||a.group&&"group"===t.type&&t.id.toString()===a.group.id.toString())});return n.forEach(({chat:t,character:a,group:e},r)=>{const n=y(t.last_mes);t.char_name=a?.name||e?.name||"",t.date_short=n.format("l"),t.date_long=n.format("LL LT"),t.chat_name=t.file_name.replace(".jsonl",""),t.char_thumbnail=a?i("avatar",a.avatar):c,t.is_group=!!e,t.hidden=r>=15,t.avatar=t.avatar||"",t.group=t.group||"",t.char_id=a?o.indexOf(a):void 0}),n.map(t=>t.chat)}const E=async(t,a)=>{try{if(await m(t),l(t),g(),p()===a)return;await h(a)}catch(t){console.error("Error selecting character:",t)}},T=async({group:t,chat_id:a,id:e})=>{try{if(!t&&!e)return;const r=e||t?.id.toString()||"";if(!r)return;if(await v(r),u(r),g(),!a||p()===a)return;await _(r,a)}catch(t){console.error("Error selecting group:",t)}},A=({chat:t,charId:a,groupId:e})=>{if(t&&t?.avatar)return i("avatar",t?.avatar);if(a||e||(a=SillyTavern.getContext().characterId,e=SillyTavern.getContext().groupId),null!=e){return SillyTavern.getContext().groups.find(t=>t.id.toString()===e.toString()).avatar_url}const r="string"==typeof a?parseInt(a):a??-1,n=SillyTavern.getContext().characters[r];return n?i("avatar",n.avatar):c};r()}catch(L){r(L)}},1)}};
//# sourceMappingURL=395.bundle.js.map