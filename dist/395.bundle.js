export const __webpack_esm_id__=395;export const __webpack_esm_ids__=[395];export const __webpack_esm_modules__={257:(t,e,r)=>{r.d(e,{V:()=>s});const a={"@script":"../../../../../script.js","@scripts/groupChats":"../../../../group-chats.js","@scripts/utils":"../../../../utils.js","@scripts/welcomeScreen":"../../../../welcome-screen.js","@scripts/personas":"../../../../personas.js","@scripts/chats":"../../../../chats.js","@scripts/powerUser":"../../../../power-user.js","@scripts/extensions":"../../../../extensions.js","@scripts/worldInfo":"../../../../world-info.js","@scripts/naiSettings":"../../../../nai-settings.js","@scripts/openai":"../../../../openai.js","@scripts/kaiSettings":"../../../../kai-settings.js","@scripts/horde":"../../../../horde.js","@scripts/textGenSettings":"../../../../textgen-settings.js","@scripts/presetManager":"../../../../preset-manager.js","@scripts/secrets":"../../../../secrets.js"},s=async t=>{try{const e=a[t]||t;return await import(e)}catch(e){return console.error(`Error importing ${t} (${a[t]}):`,e),{}}}},391:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{p:()=>m});var s=r(378),n=r(675),o=r(257).V,i=t([n]),c=i.then?(await i)():i;n=c[0];const{getGroupPastChats:d}=await o("@scripts/groupChats"),{getEntitiesList:h,eventSource:p,event_types:u,getPastCharacterChats:l}=await o("@script"),g=[{name:"Backgrounds",id:"#backgrounds-button"},{name:"Persona Management",id:"#persona-management-button"},{name:"Character Selector",id:"#rightNavHolder"},{name:"Extensions Settings",id:"#extensions-settings-button"},{name:"Advanced Formatting",id:"#advanced-formatting-button"},{name:"World Info",id:"#WI-SP-button"}],m=()=>{const[t,e]=(0,s.useState)({open:!1,entities:[],chats:[],icons:[],isLoadingChats:!0}),r=(0,s.useCallback)(t=>{e(e=>({...e,open:t}))},[]),a=(0,s.useCallback)(async()=>{e(t=>({...t,isLoadingChats:!0}));const{characterId:t,groupId:r}=SillyTavern.getContext();let a=[];try{if(null!==r)a=await d(r.toString()),e(t=>({...t,chats:a,isLoadingChats:!1}));else if(void 0!==t&&parseInt(t)>=0)a=await l(),e(t=>({...t,chats:a,isLoadingChats:!1}));else{const t=h({doFilter:!0,doSort:!0});a=await(0,n.r8)(t),e(t=>({...t,chats:a,isLoadingChats:!1}))}}catch(t){console.error("Error updating chat data:",t),e(t=>({...t,isLoadingChats:!1}))}},[]),o=(0,s.useCallback)(async()=>{const t=h({doFilter:!0,doSort:!0}),r=await(0,n.r8)(t);e(e=>({...e,chats:r,entities:t,open:!0,isLoadingChats:!1}))},[]),i=(0,s.useCallback)(()=>{const t=$("#top-settings-holder");if(!t.length)return;const r=[];t.children().each((t,e)=>{const a=$(e),s=`#${a.attr("id")}`,n=a.find(".drawer-icon");r.push({className:n.attr("class")||"",title:n.attr("title")||a.find(".drawer-toggle").attr("title")||"",showInProfile:!g.some(t=>t.id===s),id:s})}),t.attr("style","display: none !important;"),e(t=>({...t,icons:r}))},[]);return(0,s.useEffect)(()=>{i();const e=()=>{window.innerWidth>1e3&&!t.open&&r(!0)};p.on(u.APP_READY,o),p.on(u.CHAT_CHANGED,a),p.on(u.CHAT_DELETED,a),p.on(u.CHAT_CREATED,a),p.on(u.SETTINGS_UPDATED,e);const s=$("body");let n=0,c=0;const d=t=>{n=t.clientX??0},h=t=>{c=t.clientX??0},l=t=>{n=t.originalEvent?.touches[0]?.clientX??0},g=t=>{c=t.originalEvent?.touches[0]?.clientX??0},m=()=>{0!==n&&0!==c&&(c>n+100?r(!0):c<n-100&&window.innerWidth<=1e3&&r(!1),n=0,c=0)};return s&&(s.on("pointerdown",d),s.on("pointermove",h),s.on("touchstart",l),s.on("touchmove",g),s.on("touchend pointerup",m)),()=>{p.removeListener(u.APP_READY,o),p.removeListener(u.CHAT_CHANGED,a),p.removeListener(u.CHAT_DELETED,a),p.removeListener(u.CHAT_CREATED,a),p.removeListener(u.SETTINGS_UPDATED,e),s&&(s.off("pointerdown",d),s.off("pointermove",h),s.off("touchstart",l),s.off("touchmove",g),s.off("touchend pointerup",m))}},[]),{...t,setOpen:r}};a()}catch(t){a(t)}},1)},395:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{App:()=>l,default:()=>g});var s=r(714),n=r(378),o=r(799),i=r(391),c=r(875),d=r(602),h=t([i]),p=h.then?(await h)():h;i=p[0];const u=(0,n.lazy)(()=>r.e(96).then(r.bind(r,96))),l=()=>{const{open:t,setOpen:e,entities:r,chats:a,icons:n,isLoadingChats:h}=(0,i.p)();return(0,o.createPortal)((0,s.jsx)(c.YL,{children:(0,s.jsx)(u,{open:t,setOpen:e,entities:r,chats:a,icons:n,isLoadingChats:h})}),d.o)},g=l;a()}catch(t){a(t)}})},675:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{eS:()=>T,r8:()=>S,yG:()=>E,yN:()=>L});r(714),r(378);var s=r(257).V;const{characters:n,getRequestHeaders:o,getThumbnailUrl:i,system_avatar:c,default_avatar:d,openCharacterChat:h,setActiveCharacter:p,setActiveGroup:u,getCurrentChatId:l,saveSettingsDebounced:g,selectCharacterById:m}=await s("@script"),{groups:f,openGroupById:v,openGroupChat:C}=await s("@scripts/groupChats"),{sortMoments:_,timestampToMoment:y,isDataURL:w}=await s("@scripts/utils");async function S(t,e=20){const r=await fetch("/api/chats/recent",{method:"POST",headers:o(),body:JSON.stringify({max:e})});if(!r.ok)return console.warn("Failed to fetch recent character chats"),[];const a=await r.json();if(!Array.isArray(a)||0===a.length)return[];const s=a.sort((t,e)=>_(y(t.last_mes),y(e.last_mes))).map(t=>({chat:t,character:n.find(e=>e.avatar===t.avatar),group:f.find(e=>e.id===t.group)})).filter(t=>t.character||t.group).filter(e=>{if(!t||0===t.length)return!0;return!!t.find(t=>e.character&&"character"===t.type&&t.item.avatar.toString()===e.character.avatar.toString()||e.group&&"group"===t.type&&t.id.toString()===e.group.id.toString())});return s.forEach(({chat:t,character:e,group:r},a)=>{const s=y(t.last_mes);t.char_name=e?.name||r?.name||"",t.date_short=s.format("l"),t.date_long=s.format("LL LT"),t.chat_name=t.file_name.replace(".jsonl",""),t.char_thumbnail=e?i("avatar",e.avatar):c,t.is_group=!!r,t.hidden=a>=15,t.avatar=t.avatar||"",t.group=t.group||"",t.char_id=e?n.indexOf(e):void 0}),s.map(t=>t.chat)}const E=async(t,e)=>{try{if(await m(t),p(t),g(),l()===e)return;await h(e)}catch(t){console.error("Error selecting character:",t)}},T=async({group:t,chat_id:e,id:r})=>{try{if(!t&&!r)return;const a=r||t?.id.toString()||"";if(!a)return;if(await v(a),u(a),g(),!e||l()===e)return;await C(a,e)}catch(t){console.error("Error selecting group:",t)}},L=({chat:t,charId:e,groupId:r})=>{if(t&&t?.avatar)return i("avatar",t?.avatar);if(e||r||(e=SillyTavern.getContext().characterId,r=SillyTavern.getContext().groupId),null!=r){return SillyTavern.getContext().groups.find(t=>t.id.toString()===r.toString()).avatar_url}const a="string"==typeof e?parseInt(e):e??-1,s=SillyTavern.getContext().characters[a];return s?i("avatar",s.avatar):c};a()}catch(A){a(A)}},1)},875:(t,e,r)=>{r.d(e,{SQ:()=>i,YL:()=>o});var a=r(714),s=r(378);const n=(0,s.createContext)(void 0),o=({children:t})=>{const[e,r]=(0,s.useState)(""),o=(0,s.useCallback)(t=>{r(t)},[]);return(0,a.jsx)(n.Provider,{value:{searchQuery:e,setSearchQuery:o},children:t})},i=()=>{const t=(0,s.useContext)(n);if(!t)throw new Error("useSearch cannot be used outside of SearchProvider");return t}}};
//# sourceMappingURL=395.bundle.js.map