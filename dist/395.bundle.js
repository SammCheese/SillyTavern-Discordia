export const __webpack_esm_id__=395;export const __webpack_esm_ids__=[395];export const __webpack_esm_modules__={675:(t,e,a)=>{a.a(t,async(t,r)=>{try{a.d(e,{eS:()=>T,r8:()=>w,yG:()=>E,yN:()=>L});a(7259),a(6363);var n=a(7257).V;const{characters:o,getRequestHeaders:s,getThumbnailUrl:i,system_avatar:c,default_avatar:d,openCharacterChat:h,setActiveCharacter:u,setActiveGroup:l,getCurrentChatId:p,saveSettingsDebounced:g,selectCharacterById:v}=await n("@script"),{groups:f,openGroupById:m,openGroupChat:C}=await n("@scripts/groupChats"),{sortMoments:_,timestampToMoment:y,isDataURL:S}=await n("@scripts/utils");async function w(t,e=20){const a=await fetch("/api/chats/recent",{method:"POST",headers:s(),body:JSON.stringify({max:e})});if(!a.ok)return console.warn("Failed to fetch recent character chats"),[];const r=await a.json();if(!Array.isArray(r)||0===r.length)return[];const n=r.sort((t,e)=>_(y(t.last_mes),y(e.last_mes))).map(t=>({chat:t,character:o.find(e=>e.avatar===t.avatar),group:f.find(e=>e.id===t.group)})).filter(t=>t.character||t.group).filter(e=>{if(!t||0===t.length)return!0;return!!t.find(t=>e.character&&"character"===t.type&&t.item.avatar.toString()===e.character.avatar.toString()||e.group&&"group"===t.type&&t.id.toString()===e.group.id.toString())});return n.forEach(({chat:t,character:e,group:a},r)=>{const n=y(t.last_mes);t.char_name=e?.name||a?.name||"",t.date_short=n.format("l"),t.date_long=n.format("LL LT"),t.chat_name=t.file_name.replace(".jsonl",""),t.char_thumbnail=e?i("avatar",e.avatar):c,t.is_group=!!a,t.hidden=r>=15,t.avatar=t.avatar||"",t.group=t.group||"",t.char_id=e?o.indexOf(e):void 0}),n.map(t=>t.chat)}const E=async(t,e)=>{try{if(await v(t),u(t),g(),p()===e)return;await h(e)}catch(t){console.error("Error selecting character:",t)}},T=async({group:t,chat_id:e,id:a})=>{try{if(!t&&!a)return;const r=a||t?.id.toString()||"";if(!r)return;if(await m(r),l(r),g(),!e||p()===e)return;await C(r,e)}catch(t){console.error("Error selecting group:",t)}},L=({chat:t,charId:e,groupId:a})=>{if(t&&t?.avatar)return i("avatar",t?.avatar);if(e||a||(e=SillyTavern.getContext().characterId,a=SillyTavern.getContext().groupId),null!=a){return SillyTavern.getContext().groups.find(t=>t.id.toString()===a.toString()).avatar_url}const r="string"==typeof e?parseInt(e):e??-1,n=SillyTavern.getContext().characters[r];return n?i("avatar",n.avatar):c};r()}catch(A){r(A)}},1)},2395:(t,e,a)=>{a.a(t,async(t,r)=>{try{a.r(e),a.d(e,{App:()=>l,default:()=>p});var n=a(7259),o=a(6363),s=a(7841),i=a(6391),c=a(2875),d=a(402),h=t([i,d]);[i,d]=h.then?(await h)():h;const u=o.lazy(()=>a.e(96).then(a.bind(a,4096))),l=()=>{const{open:t,setOpen:e,entities:a,chats:r,icons:o,isLoadingChats:h}=(0,i.p)();return(0,s.createPortal)((0,n.jsx)(c.YL,{children:(0,n.jsx)(u,{open:t,setOpen:e,entities:a,chats:r,icons:o,isLoadingChats:h})}),d.o)},p=l;r()}catch(t){r(t)}})},2875:(t,e,a)=>{a.d(e,{SQ:()=>i,YL:()=>s});var r=a(7259),n=a(6363);const o=(0,n.createContext)(void 0),s=({children:t})=>{const[e,a]=(0,n.useState)(""),s=(0,n.useCallback)(t=>{a(t)},[]);return(0,r.jsx)(o.Provider,{value:{searchQuery:e,setSearchQuery:s},children:t})},i=()=>{const t=n.useContext(o);if(!t)throw new Error("useSearch cannot be used outside of SearchProvider");return t}},6391:(t,e,a)=>{a.a(t,async(t,r)=>{try{a.d(e,{p:()=>v});var n=a(6363),o=a(675),s=a(7257).V,i=t([o]),c=i.then?(await i)():i;o=c[0];const{getGroupPastChats:d}=await s("@scripts/groupChats"),{getEntitiesList:h,eventSource:u,event_types:l,getPastCharacterChats:p}=await s("@script"),g=[{name:"Backgrounds",id:"#backgrounds-button"},{name:"Persona Management",id:"#persona-management-button"},{name:"Character Selector",id:"#rightNavHolder"},{name:"Extensions Settings",id:"#extensions-settings-button"},{name:"Advanced Formatting",id:"#advanced-formatting-button"},{name:"World Info",id:"#WI-SP-button"}],v=()=>{const[t,e]=(0,n.useState)({open:!1,entities:[],chats:[],icons:[],isLoadingChats:!0}),a=(0,n.useCallback)(t=>{e(e=>({...e,open:t}))},[]),r=(0,n.useCallback)(async()=>{e(t=>({...t,isLoadingChats:!0}));const{characterId:t,groupId:a}=SillyTavern.getContext();let r=[];try{if(null!==a)r=await d(a.toString()),e(t=>({...t,chats:r,isLoadingChats:!1}));else if(void 0!==t&&parseInt(t)>=0)r=await p(),e(t=>({...t,chats:r,isLoadingChats:!1}));else{const t=h({doFilter:!0,doSort:!0});r=await(0,o.r8)(t),e(t=>({...t,chats:r,isLoadingChats:!1}))}}catch(t){console.error("Error updating chat data:",t),e(t=>({...t,isLoadingChats:!1}))}},[]),s=(0,n.useCallback)(async()=>{const t=h({doFilter:!0,doSort:!0}),a=await(0,o.r8)(t);e(e=>({...e,chats:a,entities:t,open:!0,isLoadingChats:!1}))},[]),i=(0,n.useCallback)(()=>{const t=$("#top-settings-holder");if(!t.length)return;const a=[];t.children().each((t,e)=>{const r=$(e),n=`#${r.attr("id")}`,o=r.find(".drawer-icon");a.push({className:o.attr("class")||"",title:o.attr("title")||r.find(".drawer-toggle").attr("title")||"",showInProfile:!g.some(t=>t.id===n),id:n})}),t.attr("style","display: none !important;"),e(t=>({...t,icons:a}))},[]);return n.useEffect(()=>{i();const e=()=>{window.innerWidth>1e3&&!t.open&&a(!0)};u.on(l.APP_READY,s),u.on(l.CHAT_CHANGED,r),u.on(l.CHAT_DELETED,r),u.on(l.CHAT_CREATED,r),u.on(l.SETTINGS_UPDATED,e);const n=$("body");let o=0,c=0;const d=t=>{o=t.clientX??0},h=t=>{c=t.clientX??0},p=t=>{o=t.originalEvent?.touches[0]?.clientX??0},g=t=>{c=t.originalEvent?.touches[0]?.clientX??0},v=()=>{0!==o&&0!==c&&(c>o+100?a(!0):c<o-100&&window.innerWidth<=1e3&&a(!1),o=0,c=0)};return n&&(n.on("pointerdown",d),n.on("pointermove",h),n.on("touchstart",p),n.on("touchmove",g),n.on("touchend pointerup",v)),()=>{u.removeListener(l.APP_READY,s),u.removeListener(l.CHAT_CHANGED,r),u.removeListener(l.CHAT_DELETED,r),u.removeListener(l.CHAT_CREATED,r),u.removeListener(l.SETTINGS_UPDATED,e),n&&(n.off("pointerdown",d),n.off("pointermove",h),n.off("touchstart",p),n.off("touchmove",g),n.off("touchend pointerup",v))}},[]),{...t,setOpen:a}};r()}catch(t){r(t)}},1)}};
//# sourceMappingURL=395.bundle.js.map