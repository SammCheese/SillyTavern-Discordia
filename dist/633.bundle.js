export const __webpack_esm_id__=633;export const __webpack_esm_ids__=[633,713,809];export const __webpack_esm_modules__={214(e,t,s){async function n(e){const t={},s=[];for(const n of e){const e=new Promise((e,s)=>{fetch(`/scripts/extensions/${n}/manifest.json`).then(async a=>{if(a.ok){const s=await a.json();t[n]=s,e(s)}else s()}).catch(e=>{s(),console.log("Could not load manifest.json for "+n,e)})});s.push(e)}return await Promise.allSettled(s),t}s.d(t,{R:()=>n})},1569(e,t,s){s.a(e,async(e,n)=>{try{s.d(t,{A:()=>b});var a=s(5656),o=s(7140),i=s(6295),r=s(7393),l=s(7713),c=s(9488),d=s(7809),u=s(6339),m=s(6153),x=s(5803),f=e([x]),h=f.then?(await f)():f;x=h[0];const p=(0,o.memo)(function({title:e,disabled:t,hasSettings:s,hasUpdates:n,onUpdateClick:i}){const r=(0,o.useCallback)(e=>{e.stopPropagation(),i?.()},[i]);return(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,a.jsx)("div",{className:"fa fa-solid fa-cog",title:"Has Settings"}),(0,a.jsx)("label",{title:`${e}${t?" (Disabled)":""}`,className:"text-lg font-medium",style:{opacity:t?.5:1},children:e})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 ml-auto mr-2",children:n&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(m.A,{size:18,faIcon:"fa fa-solid fa-download",color:"#4ade80",tooltip:"Update Available",onClick:r})})})]})}),g=(0,o.memo)(function({extension:e,manifest:t,onToggle:s,settings:n,disabled:m=!1,version:f}){const h=!t,g=(0,o.useCallback)(()=>{s(e)},[s,e]),b=(0,o.useCallback)(()=>{(0,x.Dv)(e.name)},[e.name]),y=(0,o.useMemo)(()=>t?.display_name??e.name,[t?.display_name,e.name]);return h?(0,a.jsx)(l.default,{title:(0,a.jsx)(c.A,{width:150,enableAnimation:!0}),children:(0,a.jsx)("div",{className:"p-4 flex items-center justify-between"})}):(0,a.jsx)(l.default,{title:(0,a.jsx)(p,{title:y,disabled:m,hasSettings:!!n,hasUpdates:!1===f?.isUpToDate,onUpdateClick:b}),children:(0,a.jsx)(r.A,{children:(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-2",children:[(0,a.jsxs)("span",{className:"text-sm",children:[(0,a.jsx)("div",{className:"fa fa-solid fa-book me-2"}),(0,a.jsx)("b",{children:"Version:"})," ",t?.version||"N/A"]}),(0,a.jsxs)("span",{className:"text-sm",children:[(0,a.jsx)("div",{className:"fa fa-solid fa-user me-2"}),(0,a.jsx)("b",{children:"Author:"})," ",t?.author||"N/A"]}),f&&(0,a.jsxs)("span",{className:"text-sm",children:[(0,a.jsx)("div",{className:"fa fa-solid fa-link me-2"}),(0,a.jsx)("b",{children:"Branch:"})," ",f.currentBranchName||"N/A"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,a.jsx)("label",{htmlFor:`${e.name}-enabled`,children:" Enabled "}),(0,a.jsx)(u.A,{isOn:!m,onToggle:g})]})]}),(0,a.jsx)(d.default,{}),(0,a.jsx)(i.A,{settings:n,disabled:m})]})})})}),b=(0,o.memo)(g);n()}catch(e){n(e)}})},2633(e,t,s){s.a(e,async(e,n)=>{try{s.r(t),s.d(t,{default:()=>x});var a=s(5656),o=s(7140),i=s(7229),r=s(1569),l=s(5822).V,c=e([i,r]);[i,r]=c.then?(await c)():c;const d=(0,o.lazy)(()=>s.e(53).then(s.bind(s,6053))),{saveSettingsDebounced:u}=await l("@script"),m=({title:e,extensions:t,onToggle:s})=>0===t.length?null:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:e}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsx)(r.A,{extension:e,onToggle:s,...e},e.name))})]}),x=()=>{const{toggleExtension:e,categorizedExtensions:t}=(0,i.w)(),s=(0,o.useCallback)(async t=>{await e(t)},[e]),n=(0,o.useCallback)(()=>{u()},[]),r=(0,o.useMemo)(()=>[{title:"System Extensions",extensions:t.system},{title:"Global Extensions",extensions:t.global},{title:"Local Extensions",extensions:t.local}],[t]);return(0,a.jsx)(d,{title:"Extension Settings",onClose:n,children:(0,a.jsx)("div",{className:"settings-section space-y-6",children:r.map(({title:e,extensions:t})=>t.length>0&&(0,a.jsx)(m,{title:e,extensions:t,onToggle:s},e))})})};n()}catch(e){n(e)}},1)},5803(e,t,s){s.a(e,async(e,n)=>{try{s.d(t,{Dv:()=>c,bc:()=>x,gv:()=>l,qM:()=>i});var a=s(5822).V;const{getRequestHeaders:o}=await a("@script");async function i(){try{const e=await fetch("/api/extensions/discover");if(e.ok){return await e.json()}return[]}catch(e){return console.error(e),[]}}async function r(e){const{extensionTypes:t}=await a("@scripts/extensions"),s=Object.keys(t).find(t=>t===e||t.startsWith("third-party")&&t.endsWith(e));return s?t[s]:""}async function l(e,t){try{const s=await fetch("/api/extensions/version",{method:"POST",headers:o(),body:JSON.stringify({extensionName:e.replace("third-party/",""),global:"global"===await r(e)}),signal:t});return await s.json()}catch(e){console.error("Error:",e)}}async function c(e){try{const t=await fetch("/api/extensions/update",{method:"POST",headers:o(),body:JSON.stringify({extensionName:e.replace("third-party/",""),global:"global"===await r(e)})});if(!t.ok){const e=await t.text();return toastr.error(e||t.statusText,"Extension update failed",{timeOut:5e3}),void console.error("Extension update failed",t.status,t.statusText,e)}const s=await t.json();return toastr.success(`Extension ${e} updated to ${s.shortCommitHash}`,"Extension updated",{timeOut:3e3}),s}catch(e){console.error("Extension update error:",e)}}const d=new WeakMap;function u(e){return e?(d.has(e)||d.set(e,new Set(e)),d.get(e)||null):null}const m="input, select, textarea, button";async function x(e){const t=window.discordia.extensionTemplates||[];if(0===t.length)return[];const s=u(e),n=[];for(const e of t){const t=e.find(".inline-drawer-content");if(0===t.length)continue;const a=t.find(m);if(0===a.length)continue;const o=new Map;a.each((e,t)=>{const s=t.getAttribute("discordia-settings-owner")||"unknown";o.set(s,(o.get(s)??0)+1)});const i=Array.from(o.entries()).reduce((e,[t,s])=>s>e.count?{owner:t,count:s}:e,{owner:"unknown",count:0}).owner;s&&!s.has(i)||(t.css({width:"100%",boxSizing:"border-box",display:"block"}),n.push({name:i,elem:t}))}return n}n()}catch(f){n(f)}},1)},6153(e,t,s){s.d(t,{A:()=>o});var n=s(5656),a=s(7140);const o=(0,a.memo)(({faIcon:e,size:t=24,onClick:s,tooltip:o,disabled:i=!1,color:r})=>{const l=(0,a.useCallback)(e=>{i||s?.(e)},[s,i]);return(0,n.jsx)("button",{className:`\n        flex items-center justify-center\n        ${i?"cursor-not-allowed opacity-50":"hover:bg-gray-700 cursor-pointer"}\n        rounded p-2 border border-base-discordia-lighter hover:border-gray-500 transition-all\n      `,style:{width:t+16,height:t+16},onClick:l,title:o,"aria-label":o,children:(0,n.jsx)("div",{className:`text-${t}px ${e}`,style:{color:r}})})})},6295(e,t,s){s.d(t,{A:()=>o});var n=s(5656),a=s(7140);const o=(0,a.memo)(({settings:e,disabled:t})=>{const s=(0,a.useRef)(null),o=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{const n=s.current;if(!n)return;if(o.current&&o.current.parentElement===n&&(n.removeChild(o.current),o.current=null),!e||0===e.length||t)return void(n.innerHTML="");const a=e.clone(!0).get(0);return a?(n.innerHTML="",n.appendChild(a),o.current=a,()=>{o.current&&o.current.parentElement===n&&(n.removeChild(o.current),o.current=null)}):void 0},[e,t]),!e||t?(0,n.jsx)("div",{className:"text-gray-500 text-center py-2",children:t?"Extension Disabled":"No Settings Available"}):(0,n.jsx)("div",{ref:s,className:"settings-container overflow-auto max-h-96 overflow-x-hidden"})})},6339(e,t,s){s.d(t,{A:()=>o});var n=s(5656),a=s(7140);const o=(0,a.memo)(({isOn:e,onToggle:t,onColor:s="var(--color-blurple)"})=>{const[o,i]=(0,a.useState)(e),r=(0,a.useCallback)(()=>{i(!o),t&&t()},[o,t]);return(0,n.jsx)("div",{onClick:r,style:{cursor:"pointer",width:"50px",height:"25px",borderRadius:"15px",backgroundColor:o?s:"#ccc",position:"relative",transition:"background-color 0.2s"},children:(0,n.jsx)("div",{style:{position:"absolute",top:"2.5px",left:o?"27.5px":"2.5px",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#fff",transition:"left 0.2s",boxShadow:"0 0 2px rgba(0, 0, 0, 0.2)"}})})})},7229(e,t,s){s.a(e,async(e,n)=>{try{s.d(t,{w:()=>p});var a=s(7140),o=s(5803),i=s(214),r=s(5822).V,l=e([o]),c=l.then?(await l)():l;o=c[0];const{enableExtension:d,disableExtension:u}=await r("@scripts/extensions"),{saveSettingsDebounced:m}=await r("@script"),x=e=>{const t=new Map;for(const s of e)t.set(s.name,s.elem);return t},f=e=>e.replace("third-party/",""),h=e=>e.sort((e,t)=>{if(e.disabled!==t.disabled)return e.disabled?1:-1;const s=!!e.settings;return s!==!!t.settings?s?-1:1:e.name.localeCompare(t.name)}),p=()=>{const[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)([]),[l,c]=(0,a.useState)({local:[],global:[],system:[]}),[p,g]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{const{extension_settings:e}=await r("@scripts/extensions");g(e.disabledExtensions)})()},[]),(0,a.useEffect)(()=>{m()},[p]),(0,a.useEffect)(()=>{(async()=>{const e=await(0,o.qM)(),t=await(0,i.R)(e.map(e=>e.name)),s=e.map(e=>({...e,manifest:t[e.name],version:void 0}));n(s)})()},[]),(0,a.useEffect)(()=>{(async()=>{if(0===s.length)return;const e=s.filter(e=>"system"!==e.type),t=await Promise.allSettled(e.map(async e=>{try{const t=await(0,o.gv)(e.name);return{name:e.name,version:t}}catch(t){return console.warn(`Failed to fetch version for ${e.name}:`,t),{name:e.name,version:null}}}));n(e=>e.map(e=>{if("system"===e.type)return e;const s=t.find(t=>"fulfilled"===t.status&&t.value.name===e.name);return s&&"fulfilled"===s.status?{...e,version:s.value.version}:e}))})()},[s.length]),(0,a.useEffect)(()=>{(async()=>{if(e&&e.length>0)return;const s=await(0,o.bc)();t(s)})()},[]);const b=(0,a.useMemo)(()=>e?x(e):null,[e]),y=(0,a.useMemo)(()=>b?s.map(e=>({...e,settings:b.get(f(e.name))||null})):s,[s,b]);(0,a.useEffect)(()=>{const e={local:[],global:[],system:[]};for(const t of y){const s=t.type in e?t.type:"local";e[s].push({...t,type:s,disabled:p.includes(t.name)})}e.local=h(e.local),e.global=h(e.global),e.system=h(e.system),c(e)},[y,p]);const w=(0,a.useCallback)(async e=>{try{e.disabled?(await d(e.name,!1),g(t=>t.filter(t=>t!==e.name))):(await u(e.name,!1),g(t=>[...t,e.name]))}catch(e){throw console.error("Failed to toggle extension:",e),e}},[]);return{settingsRecord:e,extensions:y,disabledExtensions:p,toggleExtension:w,categorizedExtensions:l}};n()}catch(e){n(e)}},1)},7713(e,t,s){s.r(t),s.d(t,{Accordion:()=>o,default:()=>i});var n=s(5656),a=s(7140);const o=({title:e,isOpen:t=!1,onToggle:s,children:o,destroyOnClose:i=!1})=>{const[r,l]=(0,a.useState)(t);(0,a.useEffect)(()=>{l(t)},[t]);const c=(0,a.useCallback)(()=>{l(e=>!e),s&&s()},[s]);return(0,n.jsxs)("div",{className:"accordion rounded mb-4 border border-base-discordia-lighter overflow-hidden",children:[(0,n.jsxs)("button",{className:"accordion-header cursor-pointer w-full flex justify-between items-center p-2 bg-accordion-header hover:bg-lighter transition-colors duration-200",onClick:c,children:[(0,n.jsx)("span",{className:"text-lg font-medium w-full truncate text-start",children:e}),(0,n.jsx)("span",{className:"transition-transform duration-200 "+(r?"rotate-180":""),children:(0,n.jsx)("div",{className:"fa fa-chevron-down"})})]}),(0,n.jsx)("div",{className:"accordion-content bg-input-bg transition-all duration-200 "+(r?"block p-4":"hidden"),children:(r||!i)&&o})]})},i=(0,a.memo)(o)},7809(e,t,s){s.r(t),s.d(t,{default:()=>a});var n=s(5656);const a=(0,s(7140).memo)(({width:e="w-full",className:t=""})=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{style:{backgroundColor:"rgba(255, 255, 255, 0.1)"},className:`${e} h-px my-2 mx-auto ${t}`})}))}};
//# sourceMappingURL=633.bundle.js.map