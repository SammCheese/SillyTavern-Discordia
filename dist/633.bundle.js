export const __webpack_esm_id__=633;export const __webpack_esm_ids__=[633];export const __webpack_esm_modules__={214(e,t,n){async function s(e){const t={},n=[];for(const s of e){const e=new Promise((e,n)=>{fetch(`/scripts/extensions/${s}/manifest.json`).then(async i=>{if(i.ok){const n=await i.json();t[s]=n,e(n)}else n()}).catch(e=>{n(),console.log("Could not load manifest.json for "+s,e)})});n.push(e)}return await Promise.allSettled(n),t}n.d(t,{R:()=>s})},2633(e,t,n){n.a(e,async(e,s)=>{try{n.r(t),n.d(t,{default:()=>j});var i=n(5656),a=n(7140),o=n(9488),c=n(214),l=n(7229),r=n(7393),d=n(5822).V,x=e([l]),u=x.then?(await x)():x;l=u[0];const m=(0,a.lazy)(()=>n.e(809).then(n.bind(n,7809))),g=(0,a.lazy)(()=>n.e(713).then(n.bind(n,7713))),h=(0,a.lazy)(()=>n.e(279).then(n.bind(n,4279))),f=(0,a.lazy)(()=>n.e(53).then(n.bind(n,6053))),{saveSettingsDebounced:b}=await d("@script"),p=({settings:e,disabled:t})=>{const n=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{const i=n.current;if(!i)return;if(s.current&&s.current.parentElement===i&&(i.removeChild(s.current),s.current=null),!e||0===e.length||t)return void(i.innerHTML="");const a=e.clone(!0).get(0);return a?(i.innerHTML="",i.appendChild(a),s.current=a,()=>{s.current&&s.current.parentElement===i&&(i.removeChild(s.current),s.current=null)}):void 0},[e,t]),!e||t?(0,i.jsx)("div",{className:"text-gray-500 text-center py-2",children:t?"Extension Disabled":"No Settings Available"}):(0,i.jsx)("div",{ref:n,className:"settings-container overflow-auto max-h-96 overflow-x-hidden"})},y=(0,a.memo)(function({extension:e,onToggle:t,settings:n}){const[s,l]=(0,a.useState)(e.name),[d,x]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let t=!0;return(0,c.R)([e.name]).then(n=>{t&&(l(n[e.name]?.display_name||e.name),x(!1))}),()=>{t=!1}},[]);const u=(0,a.useCallback)(()=>{t(e)},[t,e]);return d?(0,i.jsx)(g,{title:(0,i.jsx)(o.A,{width:150}),children:(0,i.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,i.jsx)("label",{children:(0,i.jsx)(o.A,{width:60})}),(0,i.jsx)(o.A,{width:40,height:20})]})}):(0,i.jsx)(g,{title:s,children:(0,i.jsx)(r.A,{children:(0,i.jsxs)("div",{className:"p-4 flex flex-col gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,i.jsx)("label",{htmlFor:`${e.name}-enabled`,children:" Enabled "}),(0,i.jsx)(h,{isOn:!e.disabled,onToggle:u})]}),(0,i.jsx)(m,{}),(0,i.jsx)(p,{settings:n,disabled:e.disabled})]})})})}),j=()=>{const e=(0,l.w)(),t=(0,a.useCallback)(async t=>{await e.toggleExtension(t)},[e.toggleExtension]),n=(0,a.useCallback)(()=>{b()},[]);return(0,i.jsx)(f,{title:"Extension Settings",onClose:n,children:(0,i.jsxs)("div",{className:"settings-section space-y-6",children:[e.categorizedExtensions.system.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"System Extensions"}),(0,i.jsx)("div",{className:"space-y-2",children:e.categorizedExtensions.system.map(e=>(0,i.jsx)(y,{extension:e,onToggle:t,settings:e.settings},e.name))})]}),e.categorizedExtensions.global.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"Global Extensions"}),(0,i.jsx)("div",{className:"space-y-2",children:e.categorizedExtensions.global.map(e=>(0,i.jsx)(y,{extension:e,onToggle:t,settings:e.settings},e.name))})]}),e.categorizedExtensions.local.length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"Local Extensions"}),(0,i.jsx)("div",{className:"space-y-2",children:e.categorizedExtensions.local.map(e=>(0,i.jsx)(y,{extension:e,onToggle:t,settings:e.settings},e.name))})]})]})})};s()}catch(e){s(e)}},1)},5803(e,t,n){async function s(){try{const e=await fetch("/api/extensions/discover");if(e.ok){return await e.json()}return[]}catch(e){return console.error(e),[]}}async function i(e){const t=window.discordia.extensionTemplates||[],n=[];for(const s of t){const t=s.find(".inline-drawer-content");if(0===t.length)continue;const i=t.find("input, select, textarea, button");if(0===i.length)continue;const a={};i.each((e,t)=>{const n=t.getAttribute("discordia-settings-owner")||"unknown";a[n]=(a[n]||0)+1});let o="unknown",c=0;for(const[e,t]of Object.entries(a))t>c&&(c=t,o=e);e&&!e.includes(o)||(t.attr("style","width: 100%; box-sizing: border-box; display: block;"),n.push({name:o,elem:t}))}return n}n.d(t,{bc:()=>i,qM:()=>s})},7229(e,t,n){n.a(e,async(e,s)=>{try{n.d(t,{w:()=>x});var i=n(7140),a=n(5803),o=n(3696),c=n(5822).V;const{enableExtension:e,disableExtension:l}=await c("@scripts/extensions"),{saveSettingsDebounced:r,eventSource:d}=await c("@script"),x=()=>{const[t,n]=(0,i.useState)(null),[s,x]=(0,i.useState)([]),[u,m]=(0,i.useState)({local:[],global:[],system:[]}),[g,h]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{const{extension_settings:e}=await c("@scripts/extensions"),t=e.disabledExtensions;h(t)})()},[]),(0,i.useEffect)(()=>{r()},[g]),(0,i.useEffect)(()=>{(async()=>{const e=await(0,a.qM)();x(e)})()},[]);const f=(0,i.useMemo)(()=>t&&0!==t.length?s.map(e=>{const n=t.find(t=>e.name.replace("third-party/","")===t.name)?.elem;return n?{...e,settings:n}:e}):s,[s,t]);(0,i.useEffect)(()=>{const e={local:[],global:[],system:[]};f.forEach(t=>{const n=t.type in e?t.type:"local";e[n].push({...t,type:n,settings:t.settings,disabled:g.includes(t.name)})}),m(e)},[f,g]),(0,i.useEffect)(()=>{const e=async()=>{const e=await(0,a.bc)();n(e)};return d.on(o.V.EXTENSION_HTML_POPULATED,e),e(),()=>{d.removeListener(o.V.EXTENSION_HTML_POPULATED,e)}},[]);return{settingsRecord:t,extensions:f,disabledExtensions:g,toggleExtension:async t=>{try{t.disabled?(await e(t.name,!1),h(e=>e.filter(e=>e!==t.name))):(await l(t.name,!1),h(e=>[...e,t.name]))}catch(e){throw console.error("Failed to toggle extension:",e),e}},categorizedExtensions:u}};s()}catch(e){s(e)}},1)}};
//# sourceMappingURL=633.bundle.js.map