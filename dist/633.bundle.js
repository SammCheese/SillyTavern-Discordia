export const __webpack_esm_id__=633;export const __webpack_esm_ids__=[633,713,809];export const __webpack_esm_modules__={214(e,t,n){async function s(e){const t={},n=[];for(const s of e){const e=new Promise((e,n)=>{fetch(`/scripts/extensions/${s}/manifest.json`).then(async a=>{if(a.ok){const n=await a.json();t[s]=n,e(n)}else n()}).catch(e=>{n(),console.log("Could not load manifest.json for "+s,e)})});n.push(e)}return await Promise.allSettled(n),t}n.d(t,{R:()=>s})},1569(e,t,n){n.a(e,async(e,s)=>{try{n.d(t,{A:()=>b});var a=n(5656),o=n(7140),i=n(6295),r=n(7393),l=n(7713),c=n(9488),d=n(7809),u=n(5803),m=n(4381),x=n(8157),f=n(6335),h=e([u]),p=h.then?(await h)():h;u=p[0];const g=(0,o.memo)(function({extension:e,manifest:t,onToggle:n,settings:s,disabled:h=!1,version:p,onDelete:g}){const[b,y]=(0,o.useState)(p);(0,o.useEffect)(()=>{y(p)},[p]);const v=!t,j=(0,o.useCallback)(()=>{n(e)},[n,e]),w=(0,o.useCallback)(()=>{(0,u.Dv)(e.name).then(()=>{y(e=>{const t=e??p;return t?{...t,isUpToDate:!0}:e??p})}).catch(t=>{console.error(`Failed to update extension ${e.name}:`,t)})},[e.name,p]),N=(0,o.useMemo)(()=>t?.display_name??e.name,[t?.display_name,e.name]),C=(0,o.useCallback)(()=>{g?.(e)},[g,e]);return v?(0,a.jsx)(l.default,{title:(0,a.jsx)(c.A,{width:150,enableAnimation:!0}),children:(0,a.jsx)("div",{className:"p-4 flex items-center justify-between"})}):(0,a.jsx)(l.default,{title:(0,a.jsx)(m.A,{title:N,disabled:h,hasSettings:!!s,hasUpdates:!1===b?.isUpToDate,onUpdateClick:w}),children:(0,a.jsx)(r.A,{children:(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(x.A,{manifest:t,version:b}),(0,a.jsx)(f.A,{extension:e,disabled:h,handleToggle:j,handleDelete:C})]}),(0,a.jsx)(d.default,{}),(0,a.jsx)(i.A,{settings:s,disabled:h})]})})})}),b=(0,o.memo)(g);s()}catch(e){s(e)}})},2633(e,t,n){n.a(e,async(e,s)=>{try{n.r(t),n.d(t,{default:()=>h});var a=n(5656),o=n(7140),i=n(7229),r=n(1569),l=n(3431),c=n(5822).V,d=e([i,r]);[i,r]=d.then?(await d)():d;const u=(0,o.lazy)(()=>n.e(53).then(n.bind(n,6053))),{saveSettingsDebounced:m}=await c("@script"),{deleteExtension:x}=await c("@scripts/extensions"),f=({title:e,extensions:t,onToggle:n})=>{if(0===t.length)return null;const{openPopup:s}=(0,o.useContext)(l.u),i=(0,o.useCallback)(e=>{const t=e.name.replace("third-party/","");s(null,{title:"Confirm Deletion",confirmText:"Delete",confirmVariant:"danger",cancelText:"Cancel",description:`Are you sure you want to delete the extension "${t}"? This action cannot be undone.`,onCancel:()=>{},onConfirm:()=>x(t)})},[s]);return(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:e}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsx)(r.A,{extension:e,onToggle:n,onDelete:i,...e},e.name))})]})},h=()=>{const{toggleExtension:e,categorizedExtensions:t}=(0,i.w)(),n=(0,o.useCallback)(async t=>{await e(t)},[e]),s=(0,o.useCallback)(()=>{m()},[]),r=(0,o.useMemo)(()=>[{title:"System Extensions",extensions:t.system},{title:"Global Extensions",extensions:t.global},{title:"Local Extensions",extensions:t.local}],[t]);return(0,a.jsx)(u,{title:"Extension Settings",onClose:s,children:(0,a.jsx)("div",{className:"settings-section space-y-6",children:r.map(({title:e,extensions:t})=>t.length>0&&(0,a.jsx)(f,{title:e,extensions:t,onToggle:n},e))})})};s()}catch(e){s(e)}},1)},4381(e,t,n){n.d(t,{A:()=>i});var s=n(5656),a=n(7140),o=n(6153);const i=(0,a.memo)(({title:e,disabled:t,hasSettings:n,hasUpdates:i,onUpdateClick:r})=>{const l=(0,a.useCallback)(e=>{e.stopPropagation(),r?.()},[r]);return(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[n&&(0,s.jsx)("div",{className:"fa fa-solid fa-cog",title:"Has Settings"}),(0,s.jsx)("label",{title:`${e}${t?" (Disabled)":""}`,className:"text-lg font-medium",style:{opacity:t?.5:1},children:e})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 ml-auto mr-2",children:i&&(0,s.jsx)(o.A,{size:18,faIcon:"fa fa-solid fa-download",color:"#4ade80",tooltip:"Update Available",onClick:l})})]})})},5803(e,t,n){n.a(e,async(e,s)=>{try{n.d(t,{Dv:()=>m,bc:()=>b,gv:()=>u,qM:()=>c});var a=n(5148),o=n(5822).V,i=e([a]),r=i.then?(await i)():i;a=r[0];const{getRequestHeaders:l}=await o("@script");async function c(){try{const e=await fetch("/api/extensions/discover");if(e.ok){return await e.json()}return[]}catch(e){return console.error(e),[]}}async function d(e){const{extensionTypes:t}=await o("@scripts/extensions"),n=Object.keys(t).find(t=>t===e||t.startsWith("third-party")&&t.endsWith(e));return n?t[n]:""}async function u(e,t){try{const n=await fetch("/api/extensions/version",{method:"POST",headers:l(),body:JSON.stringify({extensionName:e.replace("third-party/",""),global:"global"===await d(e)}),signal:t});return await n.json()}catch(e){console.error("Error:",e)}}async function m(e){try{const t=await fetch("/api/extensions/update",{method:"POST",headers:l(),body:JSON.stringify({extensionName:e.replace("third-party/",""),global:"global"===await d(e)})});if(!t.ok){const e=await t.text();return toastr.error(e||t.statusText,"Extension update failed",{timeOut:5e3}),void console.error("Extension update failed",t.status,t.statusText,e)}const n=await t.json();return toastr.success(`Extension ${e} updated to ${n.shortCommitHash}`,"Extension updated",{timeOut:3e3}),n}catch(e){console.error("Extension update error:",e)}}const x=new WeakMap;function f(e){return e?(x.has(e)||x.set(e,new Set(e)),x.get(e)||null):null}const h="input, select, textarea, button",p=e=>{e.css({width:"100%",boxSizing:"border-box",display:"block"})};function*g(e,t){let n=0;for(const s of e){const e=s.find(".inline-drawer-content");if(0===e.length)continue;const a=e.find(h);if(0===a.length)continue;const o=new Map;a.each((e,t)=>{const n=t.getAttribute("discordia-settings-owner")||"unknown";o.set(n,(o.get(n)??0)+1)});const i=Array.from(o.entries()).reduce((e,[t,n])=>n>e.count?{owner:t,count:n}:e,{owner:"unknown",count:0}).owner;t&&!t.has(i)||(p(e),yield{name:i,elem:e},n++,n%5==0&&(yield null))}}async function b(e,t){const n=window.discordia.extensionTemplates||[];if(0===n.length)return[];const s=g(n,f(e));return(0,a.WJ)(s,t)}s()}catch(y){s(y)}},1)},6153(e,t,n){n.d(t,{A:()=>o});var s=n(5656),a=n(7140);const o=(0,a.memo)(({faIcon:e,size:t=24,onClick:n,tooltip:o,disabled:i=!1,color:r})=>{const l=(0,a.useCallback)(e=>{i||n?.(e)},[n,i]);return(0,s.jsx)("button",{className:`\n        flex items-center justify-center\n        ${i?"cursor-not-allowed opacity-50":"hover:bg-gray-700 cursor-pointer"}\n        rounded p-2 border border-base-discordia-lighter hover:border-gray-500 transition-all\n      `,style:{width:t+16,height:t+16},onClick:l,title:o,"aria-label":o,children:(0,s.jsx)("div",{className:`text-${t}px ${e}`,style:{color:r}})})})},6295(e,t,n){n.d(t,{A:()=>o});var s=n(5656),a=n(7140);const o=(0,a.memo)(({settings:e,disabled:t})=>{const n=(0,a.useRef)(null),o=(0,a.useRef)(null);return(0,a.useLayoutEffect)(()=>{const s=n.current;if(!s)return;if(o.current&&o.current.parentElement===s&&(s.removeChild(o.current),o.current=null),!e||0===e.length||t)return void(s.innerHTML="");const a=e.clone(!0).get(0);return a?(s.innerHTML="",s.appendChild(a),o.current=a,()=>{o.current&&o.current.parentElement===s&&(s.removeChild(o.current),o.current=null)}):void 0},[e,t]),!e||t?(0,s.jsx)("div",{className:"text-gray-500 text-center py-2",children:t?"Extension Disabled":"No Settings Available"}):(0,s.jsx)("div",{ref:n,className:"settings-container overflow-auto max-h-96 overflow-x-hidden"})})},6335(e,t,n){n.d(t,{A:()=>r});var s=n(5656),a=n(6153),o=n(7140);const i=(0,o.memo)(({isOn:e,onToggle:t,onColor:n="var(--color-blurple)"})=>{const[a,i]=(0,o.useState)(e),r=(0,o.useCallback)(()=>{i(!a),t&&t()},[a,t]);return(0,s.jsx)("div",{onClick:r,style:{cursor:"pointer",width:"50px",height:"25px",borderRadius:"15px",backgroundColor:a?n:"#ccc",position:"relative",transition:"background-color 0.2s"},children:(0,s.jsx)("div",{style:{position:"absolute",top:"2.5px",left:a?"27.5px":"2.5px",width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"#fff",transition:"left 0.2s",boxShadow:"0 0 2px rgba(0, 0, 0, 0.2)"}})})}),r=({extension:e,disabled:t,handleToggle:n,handleDelete:o})=>(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("label",{htmlFor:`${e.name}-enabled`,children:" Enabled "})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i,{isOn:!t,onToggle:n}),"system"!==e.type&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(a.A,{faIcon:"fa fa-solid fa-trash",color:"#f87171",tooltip:"Uninstall Extension",onClick:o})})]})]})},7229(e,t,n){n.a(e,async(e,s)=>{try{n.d(t,{w:()=>b});var a=n(7140),o=n(5803),i=n(214),r=n(3696),l=n(5822).V,c=e([o]),d=c.then?(await c)():c;o=d[0];const{enableExtension:u,disableExtension:m}=await l("@scripts/extensions"),{saveSettingsDebounced:x,eventSource:f}=await l("@script"),h=e=>{const t=new Map;for(const n of e)t.set(n.name,n.elem);return t},p=e=>e.replace("third-party/",""),g=e=>e.sort((e,t)=>{if(e.disabled!==t.disabled)return e.disabled?1:-1;const n=!!e.settings;return n!==!!t.settings?n?-1:1:e.name.localeCompare(t.name)}),b=()=>{const[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)([]),[c,d]=(0,a.useState)({local:[],global:[],system:[]}),[b,y]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{const{extension_settings:e}=await l("@scripts/extensions");y(e.disabledExtensions)})()},[]),(0,a.useEffect)(()=>{x()},[b]),(0,a.useEffect)(()=>{(async()=>{const e=await(0,o.qM)(),t=await(0,i.R)(e.map(e=>e.name)),n=e.map(e=>({...e,manifest:t[e.name],version:void 0}));s(n)})()},[]);const v=(0,a.useMemo)(()=>n.filter(e=>"system"!==e.type).map(e=>[e.name,e.type,e.version?.currentCommitHash??"",e.version?.currentBranchName??"",String(e.version?.isUpToDate??"")].join(":")).join("|"),[n]);(0,a.useEffect)(()=>{(async()=>{if(0===n.length)return;const e=n.filter(e=>"system"!==e.type),t=await Promise.allSettled(e.map(async e=>{try{const t=await(0,o.gv)(e.name);return{name:e.name,version:t}}catch(t){return console.warn(`Failed to fetch version for ${e.name}:`,t),{name:e.name,version:null}}}));s(e=>e.map(e=>{if("system"===e.type)return e;const n=t.find(t=>"fulfilled"===t.status&&t.value.name===e.name);return n&&"fulfilled"===n.status?{...e,version:n.value.version}:e}))})()},[v]),(0,a.useEffect)(()=>{const n=new AbortController,s=async(s=!1)=>{if(!(e&&e.length>0)||s)try{const e=await(0,o.bc)(void 0,n.signal);t(e)}catch(e){"AbortError"===e.name?console.log("Fetch extension settings aborted"):console.error("Failed to fetch extension settings:",e)}},a=()=>s(!0);return s(),f.on(r.V.EXTENSION_HTML_POPULATED,a),()=>{n.abort(),f.removeListener(r.V.EXTENSION_HTML_POPULATED,a)}},[]);const j=(0,a.useMemo)(()=>e?h(e):null,[e]),w=(0,a.useMemo)(()=>j?n.map(e=>({...e,settings:j.get(p(e.name))||null})):n,[n,j]);(0,a.useEffect)(()=>{const e={local:[],global:[],system:[]};for(const t of w){const n=t.type in e?t.type:"local";e[n].push({...t,type:n,disabled:b.includes(t.name)})}e.local=g(e.local),e.global=g(e.global),e.system=g(e.system),d(e)},[w,b]);const N=(0,a.useCallback)(async e=>{try{e.disabled?(await u(e.name,!1),y(t=>t.filter(t=>t!==e.name))):(await m(e.name,!1),y(t=>[...t,e.name]))}catch(e){throw console.error("Failed to toggle extension:",e),e}},[]);return{settingsRecord:e,extensions:w,disabledExtensions:b,toggleExtension:N,categorizedExtensions:c}};s()}catch(e){s(e)}},1)},7713(e,t,n){n.r(t),n.d(t,{Accordion:()=>o,default:()=>i});var s=n(5656),a=n(7140);const o=({title:e,isOpen:t=!1,onToggle:n,children:o,destroyOnClose:i=!1})=>{const[r,l]=(0,a.useState)(t);(0,a.useEffect)(()=>{l(t)},[t]);const c=(0,a.useCallback)(()=>{l(e=>!e),n&&n()},[n]);return(0,s.jsxs)("div",{className:"accordion rounded mb-4 border border-base-discordia-lighter overflow-hidden",children:[(0,s.jsxs)("div",{tabIndex:0,className:"accordion-header cursor-pointer w-full flex justify-between items-center p-2 bg-accordion-header hover:bg-lighter transition-colors duration-200",onClick:c,children:[(0,s.jsx)("span",{className:"text-lg font-medium w-full truncate text-start",children:e}),(0,s.jsx)("span",{className:"transition-transform duration-200 "+(r?"rotate-180":""),children:(0,s.jsx)("div",{className:"fa fa-chevron-down"})})]}),(0,s.jsx)("div",{className:"accordion-content bg-input-bg transition-all duration-200 "+(r?"block p-4":"hidden"),children:(r||!i)&&o})]})},i=(0,a.memo)(o)},7809(e,t,n){n.r(t),n.d(t,{default:()=>a});var s=n(5656);const a=(0,n(7140).memo)(({width:e="w-full",className:t=""})=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{style:{backgroundColor:"rgba(255, 255, 255, 0.1)"},className:`${e} h-px my-2 mx-auto ${t}`})}))},8157(e,t,n){n.d(t,{A:()=>a});var s=n(5656);const a=(0,n(7140).memo)(({manifest:e,version:t})=>(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsxs)("div",{className:"flex flex-row gap-1 mb-2 justify-between ",children:[(0,s.jsxs)("span",{className:"text-sm truncate",children:[(0,s.jsx)("div",{className:"fa fa-solid fa-book me-2"}),(0,s.jsx)("b",{children:"Version:"})," ",e?.version||"N/A"]}),(0,s.jsxs)("span",{className:"text-sm  truncate",children:[(0,s.jsx)("div",{className:"fa fa-solid fa-user me-2"}),(0,s.jsx)("b",{children:"Author:"})," ",(0,s.jsx)("span",{children:e?.author||"N/A"})]})]}),t&&(0,s.jsxs)("div",{className:"flex flex-row gap-1 justify-between",children:[(0,s.jsxs)("span",{className:"text-sm truncate",children:[(0,s.jsx)("div",{className:"fa fa-solid fa-link me-2"}),(0,s.jsx)("b",{children:"Branch:"})," ",t.currentBranchName||"N/A"]}),(0,s.jsxs)("span",{className:"text-sm truncate",children:[(0,s.jsx)("div",{className:"fa fa-solid fa-code-commit me-2"}),(0,s.jsx)("b",{children:"Commit:"})," ",(0,s.jsx)("a",{className:"",href:`${t.remoteUrl}/commit/${t.currentCommitHash}`,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("span",{className:"hover:opacity-50 transition-opacity duration-200 truncate",children:t.currentCommitHash.substring(0,7)||"N/A"})})]})]})]}))}};
//# sourceMappingURL=633.bundle.js.map