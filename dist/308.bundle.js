export const __webpack_esm_id__=308;export const __webpack_esm_ids__=[308];export const __webpack_esm_modules__={176(e,a,t){t.d(a,{A:()=>r});var s=t(5656),n=t(7140);const r=(0,n.memo)(({icon:e,onClick:a,apiConnected:t=!1,enabled:r=!0})=>{const o=(0,n.useMemo)(()=>e.className.includes("fa-plug"),[e.className]),c=(0,n.useMemo)(()=>t?e.className.replace("redOverlayGlow","").replace("fa-plug-circle-exclamation","fa-plug"):`${e.className}`,[t,e.className]),l=(0,n.useMemo)(()=>[{id:"#user-settings-button",className:"drawer-icon fa-solid fa-gear fa interactable closedIcon"}],[]),i=(0,n.useMemo)(()=>{const a=l.find(a=>a.id===e.id);return a?a.className:e.className},[e.className,e.id,l]),u=(0,n.useCallback)(()=>{a&&r&&a(e)},[a,r,e]);return o?(0,s.jsx)("div",{className:c,title:e.title,onClick:u}):(0,s.jsx)("div",{className:i,title:e.title,onClick:u})})},384(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{B:()=>u});var n=t(7140),r=t(2298),o=t(2418),c=t(9232).f,l=e([o]),i=l.then?(await l)():l;o=i[0];const u=()=>{const{showContextMenu:e}=(0,r.EF)(),a=(0,n.useCallback)(()=>{(0,o.r)().catch(e=>{c.error("Error during logout:",e)})},[]),t=(0,n.useCallback)(()=>{document.fullscreenElement?document.exitFullscreen().catch(e=>{c.error(`Error attempting to exit full-screen mode: ${e.message} (${e.name})`)}):document.documentElement.requestFullscreen().catch(e=>{c.error(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})},[]),s=(0,n.useMemo)(()=>[{label:(document.fullscreenElement?"Exit":"Enter")+" Fullscreen",onClick:t},{label:"Log Out",variant:"danger",onClick:a}],[t,a]);return{handleContextMenu:(0,n.useCallback)(a=>{a.preventDefault(),e(a,s)},[s,e])}};s()}catch(e){s(e)}})},2308(e,a,t){t.a(e,async(e,s)=>{try{t.r(a),t.d(a,{default:()=>g});var n=t(5656),r=t(7140),o=t(8677),c=t(4239),l=t(176),i=t(3659).V,u=e([o,c]);[o,c]=u.then?(await u)():u;const d=(0,r.lazy)(()=>t.e(881).then(t.bind(t,9881))),m=(0,r.lazy)(()=>t.e(334).then(t.bind(t,1334))),p=(0,r.lazy)(()=>t.e(759).then(t.bind(t,1759))),{eventSource:h,event_types:v}=await i("@script"),f=({icons:e=null})=>{const[a,t]=(0,r.useState)("no_connection"),{openPage:s}=(0,o.N5)(),i=(0,r.useCallback)(()=>{"no_connection"===SillyTavern.getContext().onlineStatus?t("no_connection"):t("online")},[]);(0,r.useEffect)(()=>(h.on(v.ONLINE_STATUS_CHANGED,i),()=>{h.removeListener(v.ONLINE_STATUS_CHANGED,i)}),[i]);const u=(0,r.useCallback)(e=>{const a=e.id;switch(a){case"#user-settings-button":s((0,n.jsx)(d,{}));break;case"#ai-config-button":s((0,n.jsx)(m,{}));break;case"#sys-settings-button":s((0,n.jsx)(p,{}));break;default:console.log(`No action defined for icon with id: ${a}`)}},[s]),f=(0,r.useMemo)(()=>"no_connection"!==a,[a]),g=(0,r.useMemo)(()=>e?.filter(e=>e.showInProfile)||[],[e]);return(0,n.jsxs)("div",{id:"user-profile-container",children:[(0,n.jsx)(c.A,{}),(0,n.jsx)("div",{id:"user-settings-buttons",children:g.map((e,a)=>(0,n.jsx)(l.A,{apiConnected:f,icon:e,onClick:u},e.id||a))})]})},g=(0,r.memo)(f);s()}catch(e){s(e)}},1)},2418(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{r:()=>o});var n=t(3659).V;const{getRequestHeaders:r}=await n("@script");async function o(){await fetch("/api/users/logout",{method:"POST",headers:r({omitContentType:!0})});const e=new URLSearchParams(window.location.search);e.set("noauto","true"),window.location.search=e.toString()}s()}catch(c){s(c)}},1)},4239(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{A:()=>h});var n=t(5656),r=t(7140),o=t(5091),c=t(384),l=t(3659).V,i=e([o,c]);[o,c]=i.then?(await i)():i;const{getThumbnailUrl:u}=await l("@script"),{getUserAvatars:d,setUserAvatar:m}=await l("@scripts/personas"),{power_user:p}=await l("@scripts/powerUser"),h=()=>{const[e,a]=(0,r.useState)([]),[t,s]=(0,r.useState)(!1),[l,i]=(0,r.useState)(null),h=(0,r.useRef)(null),{handleContextMenu:v}=(0,c.B)(),f=(0,r.useCallback)(()=>{s(e=>!e)},[]);(0,r.useEffect)(()=>{(async()=>{try{const e=await d(),t=e.map(e=>p.personas[e]||e);a(e.map((e,a)=>({name:t[a],avatar:e})))}catch(e){console.error("Error fetching user personas:",e)}})()},[]),(0,r.useEffect)(()=>{if(!t)return;const e=e=>{h.current&&!h.current.contains(e.target)&&s(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[t]);const g=(0,r.useCallback)(e=>{s(!1),m(e.avatar,{toastPersonaNameChange:!0}).catch(e=>{console.error("Error setting user avatar:",e)}),i(e)},[]),x=(0,r.useMemo)(()=>p.personas[l?.avatar||"user-default.png"]||e.find(e=>e.avatar===l?.avatar)?.name||"User",[l,e]),b=(0,r.useMemo)(()=>u("persona",l?.avatar||"user-default.png"),[l]);return(0,n.jsxs)("div",{className:"relative w-full",ref:h,children:[(0,n.jsxs)("div",{id:"profile-persona-container",className:"hover:bg-lighter select-none w-full cursor-pointer flex items-center rounded-md transition-colors ease-in-out",onContextMenu:v,onClick:f,children:[(0,n.jsx)("div",{id:"user-avatar",className:"mx-1 h-10 w-10 shrink-0 flex items-center justify-center",children:(0,n.jsx)("img",{loading:"lazy",id:"discordia-avatar",src:b,style:{width:"36px",height:"36px",borderRadius:"50%",objectFit:"cover",cursor:"pointer"},alt:"User Avatar"})}),(0,n.jsxs)("div",{id:"user-info",children:[" ",(0,n.jsx)("div",{id:"user-name",className:"select-none",children:x}),(0,n.jsx)("div",{id:"user-status"})]})]}),t&&e.length>0&&(0,n.jsx)("div",{className:"absolute bottom-[calc(100%+8px)] -left-1 z-50",children:(0,n.jsx)(o.A,{personas:e,onSelect:g})})]})};s()}catch(e){s(e)}},1)},5091(e,a,t){t.a(e,async(e,s)=>{try{t.d(a,{A:()=>i});var n=t(5656),r=t(7140),o=t(3659).V;const{getThumbnailUrl:e}=await o("@script"),c=({personas:e,onSelect:a})=>{const t=(0,r.useMemo)(()=>[...e].sort((e,a)=>e.avatar.localeCompare(a.avatar)),[e]),s=(0,r.useCallback)(e=>{a&&a(e)},[a]);return t.length?(0,n.jsx)("div",{className:"max-h-64 w-64 overflow-y-auto rounded-md border border-gray-700 bg-base-discordia shadow-lg",children:t.map(e=>(0,n.jsx)(l,{persona:e,onClick:s},e.avatar))}):(0,n.jsx)("div",{className:"p-3 text-sm text-gray-300",children:"No personas available"})},l=(0,r.memo)(function({persona:a,onClick:t}){const s=(0,r.useMemo)(()=>e("persona",a.avatar||"user-default.png"),[a]),o=(0,r.useCallback)(()=>{t&&t(a)},[t,a]);return(0,n.jsxs)("button",{className:"cursor-pointer flex w-full items-center gap-2 px-3 py-2 text-left text-sm hover:bg-lighter transition-colors",onClick:o,children:[(0,n.jsx)("img",{loading:"lazy",src:s,alt:a.name,className:"h-8 w-8 rounded-full object-cover"}),(0,n.jsx)("span",{className:"truncate",children:a.name})]},a.avatar)}),i=(0,r.memo)(c);s()}catch(e){s(e)}},1)}};
//# sourceMappingURL=308.bundle.js.map