export const __webpack_esm_id__=788;export const __webpack_esm_ids__=[345,713,788];export const __webpack_esm_modules__={2332(e,a,t){t.d(a,{A:()=>d});var r=t(5656),s=t(7140);const n=(0,s.memo)(({children:e})=>(0,r.jsx)("div",{className:"p-4 flex-1 overflow-y-auto min-h-0 custom-scrollbar",children:e})),o=(0,s.memo)(({children:e})=>(0,r.jsx)("div",{className:"rounded-b-lg flex shrink-0 justify-end space-x-2 p-4 border-t border-gray-700 w-full bg-base-discordia",children:e}));var i=t(1778);const l=(0,s.memo)(({title:e,onClose:a,children:t,canClose:n=!0})=>{const{closeModal:o}=(0,s.useContext)(i.Vs);return(0,r.jsxs)("div",{className:"px-4 py-4 shrink-0 border-b border-gray-700 flex items-center justify-between w-full",children:[(0,r.jsx)("div",{className:"text-lg font-semibold m-0",children:e??t}),(0,r.jsx)("div",{className:"flex items-center",children:n&&(0,r.jsx)("button",{onClick:()=>{a&&a(),o()},className:"text-gray-400  hover:text-white cursor-pointer focus:outline-none","aria-label":"Close modal",children:"âœ•"})})]})}),c=({children:e,className:a=""})=>(0,r.jsx)("div",{className:`flex flex-col w-full h-full\n        bg-base-discordia rounded-lg shadow-2xl border border-gray-700\n        overflow-hidden ${a}`,children:e});c.Header=l,c.Content=n,c.Footer=o;const d=c},4345(e,a,t){t.r(a),t.d(a,{default:()=>n});var r=t(5656),s=t(7140);const n=(0,s.memo)(({placeholder:e="",defaultValue:a="",value:t,label:n="",onChange:o,style:i,disabled:l=!1,id:c="",type:d="text",growHeight:m=!1,maxHeight:u=160})=>{const h=t??a??"",p=(0,s.useRef)(null),f=(0,s.useCallback)(e=>{o(e.target.value)},[o]);return(0,s.useEffect)(()=>{m&&p.current&&(p.current.style.height="auto",p.current.style.height=`${Math.min(p.current.scrollHeight,u)}px`)},[h,m,u]),(0,r.jsxs)("div",{className:"flex flex-col w-full gap-1 ",style:i,children:[n&&(0,r.jsx)("label",{className:"text-sm font-medium mb-1",htmlFor:c,children:n}),m?(0,r.jsx)("textarea",{ref:p,id:c,disabled:l,style:m?{maxHeight:`${u}px`,overflowY:"auto"}:void 0,className:"input-field w-full px-3 py-2 bg-input-bg rounded-md outline outline-input-outline focus:ring-2 focus:ring-input-ring resize-none text-wrap wrap-break-word",placeholder:e,value:h,onChange:f,rows:1}):(0,r.jsx)("input",{contentEditable:m,id:c,disabled:l,className:"input-field w-full px-3 py-2 bg-input-bg rounded-md outline outline-input-outline focus:ring-2 focus:ring-input-ring",placeholder:e,type:d,value:h,onChange:f})]})})},4788(e,a,t){t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>_});var s=t(5656),n=t(7140),o=t(1778),i=t(5599),l=t(4345),c=t(2332),d=t(7713),m=t(5864),u=t(3696),h=t(5822).V,p=e([m]),f=p.then?(await p)():p;m=f[0];const{getThumbnailUrl:b,eventSource:g,event_types:x,deleteCharacter:v}=await h("@script"),{getContext:w}=SillyTavern,y=(0,n.memo)(({field:e,value:a,onChange:t,...r})=>{const o=(0,n.useCallback)(a=>{t({[e]:a})},[t,e]);return(0,s.jsx)(l.default,{value:a||"",onChange:o,...r})}),_=({onClose:e,avatarName:a,onSave:t})=>{const[r,l]=(0,n.useState)(null),[h,p]=(0,n.useState)(null),{closeModal:f}=(0,n.useContext)(o.Vs),_=(0,n.useCallback)(e=>{l(a=>{if(!a)return a;const t={};"name"in e&&(t.name=e.name),"description"in e&&(t.description=e.description),"scenario"in e&&(t.scenario=e.scenario),"personality"in e&&(t.personality=e.personality),"first_mes"in e&&(t.first_mes=e.first_mes),"mes_example"in e&&(t.mes_example=e.mes_example),"creatorcomment"in e&&(t.creator_notes=e.creatorcomment);const r=Object.keys(t).length?{...a.data||{},...t}:a.data;return{...a,...e,data:r}})},[]),j=(0,n.useMemo)(()=>b("avatar",r?.avatar?.toString()||"default"),[r?.avatar]);(0,n.useEffect)(()=>{const e=w().characters.find(e=>e.avatar?.toString()===a);if(e){l(e);const a=w().characters.indexOf(e);-1!==a&&p(a)}},[a]);const N=(0,n.useCallback)(()=>{if(t&&t(),!r)return;const e=(0,m.QE)(r);(0,m.t9)(a,e).then(()=>{g.emit(x.CHARACTER_EDITED,{detail:{id:h,character:r}}),f()})},[t,h,f,a,r]),C=(0,n.useCallback)(()=>{e&&e(),f()},[e,f]),k=(0,n.useCallback)(()=>{null!==a&&v(a,{deleteChats:!0}).then(()=>{g.emit(u.V.ENTITIES_LENGTH_CHANGED),f()})},[a,f]);return(0,s.jsxs)(c.A,{children:[(0,s.jsx)(c.A.Header,{onClose:C,children:"Edit Character"}),(0,s.jsxs)(c.A.Content,{children:[(0,s.jsxs)("div",{id:"avatar-name-edit",className:"flex w-full align-top p-6",children:[(0,s.jsx)("div",{className:"w-32 flex items-center",children:(0,s.jsx)("img",{loading:"lazy",src:j,alt:"Avatar",className:"w-32 h-32 rounded-full object-cover border-2 border-gray-700 shrink-0"})}),(0,s.jsxs)("div",{className:"grow space-y-2 ms-4 relative top-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",htmlFor:"name",children:"Name"}),(0,s.jsx)(y,{id:"name",field:"name",value:r?.name,onChange:_,placeholder:"Enter character name"})]})]}),(0,s.jsx)(d.default,{title:"Creator Notes",children:(0,s.jsx)("div",{id:"creator-notes-edit",className:"p-3 w-full space-y-2",children:(0,s.jsx)(y,{id:"creator_notes",field:"creatorcomment",value:r?.creatorcomment,onChange:_,growHeight:!0,disabled:!0})})}),(0,s.jsxs)("div",{id:"description-edit",className:"p-3 w-full space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",htmlFor:"description",children:"Description"}),(0,s.jsx)(y,{id:"description",field:"description",value:r?.description,onChange:_,growHeight:!0})]}),(0,s.jsxs)("div",{id:"first-message-edit",className:"p-3 w-full space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",htmlFor:"first_message",children:"First Message"}),(0,s.jsx)(y,{id:"first_message",field:"first_mes",value:r?.first_mes,onChange:_,growHeight:!0})]}),(0,s.jsxs)("div",{id:"scenario-edit",className:"p-3 w-full space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",htmlFor:"scenario",children:"Scenario"}),(0,s.jsx)(y,{id:"scenario",field:"scenario",value:r?.scenario,defaultValue:"A chat between {{user}} and {{char}}.",onChange:_,growHeight:!0})]})]}),(0,s.jsxs)(c.A.Footer,{children:[(0,s.jsx)("div",{className:"grow",children:(0,s.jsx)(i.A,{look:i.m.DANGER,onClick:k,children:"Delete"})}),(0,s.jsx)(i.A,{look:i.m.TRANSPARENT,onClick:C,children:"Cancel"}),(0,s.jsx)(i.A,{onClick:N,children:"Save"})]})]})};r()}catch(e){r(e)}},1)},5599(e,a,t){t.d(a,{A:()=>o,m:()=>r});var r,s=t(5656),n=t(7140);!function(e){e.DANGER="danger",e.PRIMARY="primary",e.SECONDARY="secondary",e.TRANSPARENT="transparent"}(r||(r={}));const o=(0,n.memo)(({label:e,onClick:a,children:t,disabled:o=!1,look:i=r.PRIMARY})=>{const l=(0,n.useCallback)(()=>{!o&&a&&a()},[o,a]),c=(0,n.useCallback)(()=>{switch(i){case r.DANGER:return"bg-red-600 hover:bg-red-700 border-red-700";case r.SECONDARY:return"bg-gray-600 hover:bg-gray-700 border-gray-700";case r.PRIMARY:return"hover:bg-blurple-lighter bg-blurple border-blurple";case r.TRANSPARENT:return"bg-transparent hover:border-blurple border-white";default:return"hover:bg-blurple-lighter bg-blurple border-blurple"}},[i]),d=(0,n.useMemo)(()=>c(),[c]);return(0,s.jsx)("button",{className:`px-4 py-2 text-white font-bold border cursor-pointer rounded disabled:opacity-50 ${d}`,onClick:l,disabled:o,children:e||t})})},5864(e,a,t){t.a(e,async(e,r)=>{try{t.d(a,{QE:()=>c,t9:()=>m});var s=t(5822).V;const{getRequestHeaders:n,getCharacters:o}=await s("@script"),{ensureImageFormatSupported:i}=await s("@scripts/utils");async function l(e){const a=new FormData;if(e.avatar instanceof File){const t=await i(e.avatar);a.append("avatar",t)}else"string"==typeof e.avatar&&a.append("avatar_url",e.avatar);Object.keys(e).forEach(t=>{const r=e[t];null!=r&&"avatar"!==t&&(Array.isArray(r)?"tags"===t?a.append(t,r.join(",")):r.forEach(e=>a.append(t,String(e))):a.append(t,String(r)))});const t=await fetch("/api/characters/edit",{method:"POST",headers:n({omitContentType:!0}),body:a,cache:"no-cache"});if(!t.ok){const e=await t.text();throw new Error(e||t.statusText)}}function c(e){const a=(a,t)=>e.data&&void 0!==e.data[a]&&""!==e.data[a]?e.data[a]:t&&void 0!==e[t]?e[t]:void 0!==e[a]?e[a]:"",t=a=>e.data?.extensions?.[a]??void 0,r=e.data?.extensions?.depth_prompt??{},s={...e.data?.extensions||{}};delete s.depth_prompt,delete s.talkativeness,delete s.fav,delete s.world;let n=a("tags");"string"==typeof n?n=n.split(",").map(e=>e.trim()).filter(e=>e):Array.isArray(n)||(n=[]);let o=a("alternate_greetings");Array.isArray(o)||(o=[]);const i={ch_name:a("name")||e.name||"",avatar:e.avatar||"none",description:a("description"),personality:a("personality"),scenario:a("scenario"),first_mes:a("first_mes"),mes_example:a("mes_example"),creator_notes:a("creator_notes","creatorcomment"),tags:n,creator:a("creator"),character_version:a("character_version"),system_prompt:a("system_prompt"),post_history_instructions:a("post_history_instructions"),alternate_greetings:o,talkativeness:t("talkativeness")??e.talkativeness??.5,fav:String(t("fav")??e.fav??!1),world:t("world")??e.world??"",depth_prompt_prompt:r.prompt??"",depth_prompt_depth:isNaN(Number(r.depth))?4:Number(r.depth),depth_prompt_role:r.role??"system"};return Object.keys(s).length>0&&(i.extensions=JSON.stringify(s)),i}async function d(e,a){if(!e||!a)throw new Error("Avatar URL and new name are required to rename character.");const t=await fetch("/api/characters/rename",{method:"POST",headers:n(),body:JSON.stringify({avatar_url:e,new_name:a}),cache:"no-cache"});if(!t.ok)throw new Error(`Failed to rename character: ${t.statusText}`);return(await t.json()).avatar}async function m(e,a){const t=SillyTavern.getContext().characters.find(a=>a.avatar?.toString()===e)?.name;if(!t)throw new Error("Original character not found for update.");if(await l({...a,avatar:e}),a.ch_name&&a.ch_name!==t)try{return await d(e,a.ch_name)}catch(e){throw console.error("Edit successful, but Rename failed:",e),e}return await o(),e}r()}catch(u){r(u)}},1)},7713(e,a,t){t.r(a),t.d(a,{Accordion:()=>n,default:()=>o});var r=t(5656),s=t(7140);const n=({title:e,isOpen:a=!1,onToggle:t,children:n})=>{const[o,i]=(0,s.useState)(a),l=(0,s.useCallback)(()=>{i(!o),t&&t()},[o,t]);return(0,r.jsxs)("div",{className:"accordion rounded mb-4 border border-base-discordia-lighter overflow-hidden",children:[(0,r.jsxs)("button",{className:"accordion-header cursor-pointer w-full flex justify-between items-center p-2 bg-accordion-header hover:bg-lighter transition-colors duration-200",onClick:l,children:[(0,r.jsx)("span",{className:"text-lg font-medium",children:e}),(0,r.jsx)("span",{children:o?(0,r.jsx)("div",{className:"fa fa-chevron-up"}):(0,r.jsx)("div",{className:"fa fa-chevron-down"})})]}),o&&(0,r.jsx)("div",{className:"accordion-content p-4 bg-input-bg",children:n})]})},o=(0,s.memo)(n)}};
//# sourceMappingURL=788.bundle.js.map